# 启动服务命令

## 方式1：使用一键启动脚本（推荐）

```powershell
cd D:\Programs\github\lingua_1\electron_node\services\semantic_repair_zh
.\start_all_in_one.ps1
```

**优点**：
- 自动检查环境
- 自动检查端口冲突
- 自动等待服务就绪
- 自动显示诊断信息

## 方式2：直接使用 Python 启动

```powershell
cd D:\Programs\github\lingua_1\electron_node\services\semantic_repair_zh
python semantic_repair_zh_service.py
```

**自定义端口和主机**：
```powershell
$env:PORT = 5013
$env:HOST = "127.0.0.1"
python semantic_repair_zh_service.py
```

## 方式3：使用 uvicorn 命令

```powershell
cd D:\Programs\github\lingua_1\electron_node\services\semantic_repair_zh
uvicorn semantic_repair_zh_service:app --host 127.0.0.1 --port 5013 --workers 1
```

## 默认配置

- **端口**：5013
- **主机**：127.0.0.1
- **工作进程**：1（单进程模式）

## 检查服务状态

### 健康检查
```powershell
curl http://127.0.0.1:5013/health
```

### 诊断信息
```powershell
curl http://127.0.0.1:5013/diagnostics
```

### 测试修复功能
```powershell
# 使用 curl
curl -X POST http://127.0.0.1:5013/repair `
  -H "Content-Type: application/json" `
  -d '{"job_id":"test","session_id":"test","text_in":"你好，这是一个测试。","lang":"zh"}'

# 使用 PowerShell
$body = @{
    job_id = "test_job_001"
    session_id = "test_session_001"
    text_in = "你好，这是一个测试。"
    lang = "zh"
} | ConvertTo-Json
Invoke-RestMethod -Uri "http://127.0.0.1:5013/repair" -Method Post -Body $body -ContentType "application/json"
```

### 使用 Python 测试脚本（推荐）
```powershell
cd D:\Programs\github\lingua_1\electron_node\services\semantic_repair_zh
python test_service.py
```

### 使用 PowerShell 测试脚本
```powershell
cd D:\Programs\github\lingua_1\electron_node\services\semantic_repair_zh
.\test_service.ps1
```

### 快速测试命令（单行）
```powershell
# 健康检查
Invoke-RestMethod -Uri "http://127.0.0.1:5013/health"

# 诊断信息
Invoke-RestMethod -Uri "http://127.0.0.1:5013/diagnostics"

# 测试修复
$body = @{job_id="test";session_id="test";text_in="你好，这是一个测试文本。";lang="zh"} | ConvertTo-Json; Invoke-RestMethod -Uri "http://127.0.0.1:5013/repair" -Method Post -Body $body -ContentType "application/json"
```

## 注意事项

1. **确保 GGUF 模型已下载**
   - 模型路径：`models/qwen2.5-3b-instruct-zh-gguf/`
   - 推荐模型：`qwen2.5-3b-instruct-q4_k_m.gguf`

2. **确保 llama-cpp-python 已安装**
   ```powershell
   python -c "from llama_cpp import Llama; print('OK')"
   ```

3. **如果端口被占用**
   - 检查是否有其他实例在运行
   - 或修改 `$env:PORT` 使用其他端口

## 查看日志

服务启动后，日志会直接输出到控制台。如果需要保存日志：

```powershell
python semantic_repair_zh_service.py 2>&1 | Tee-Object -FilePath "service.log"
```
