# ÒôÆµ´¦ÀíÍêÕûÎÄµµ (Part 5/6)

**æ—¥æœŸ**: 2025-12-25  
**çŠ¶æ€?*: âœ?**å·²ä¿®å¤?*

---

## é—®é¢˜æè¿°

ç”¨æˆ·æŒç»­è¯´äº†30ç§’ï¼Œä½†èŠ‚ç‚¹ç«¯æ”¶åˆ°çš„éŸ³é¢‘åªæœ?.24ç§’ï¼ˆ3840 samplesï¼‰ã€?

---

## é—®é¢˜åˆ†æ

### 1. ä¸ºä»€ä¹ˆä¼šè°ƒç”¨ `read_pcm16` æ–¹æ³•ï¼?

è™½ç„¶è¾“å…¥æ•°æ®æ ¼å¼æ˜?Opusï¼Œä½†è§£ç æµç¨‹éœ€è¦è½¬æ¢ä¸º PCM16ï¼?

```
Opus packets (è¾“å…¥)
  â†?
OpusPacketDecodingPipeline.feed_data()  (è§£ç  Opus packets)
  â†?
PCM16RingBuffer.write()  (å­˜å‚¨è§£ç åçš„ PCM16 æ•°æ®)
  â†?
OpusPacketDecodingPipeline.read_pcm16()  (è¯»å– PCM16 æ•°æ®)
  â†?
numpy array (float32)  (è½¬æ¢ä¸?ASR æ¨¡å‹éœ€è¦çš„æ ¼å¼)
```

**åŸå› **ï¼?
- Opus æ˜¯å‹ç¼©æ ¼å¼ï¼ŒASR æ¨¡å‹éœ€è¦çš„æ˜?PCM16 æ ¼å¼çš„éŸ³é¢?
- `read_pcm16` æ˜¯ä» ring buffer ä¸­è¯»å–å·²è§£ç çš?PCM16 æ•°æ®ï¼Œè¿™æ˜¯æ­£å¸¸çš„è§£ç æµç¨‹

---

### 2. è°ƒåº¦æœåŠ¡å™¨æ˜¯å¦é€šè¿‡å°†éŸ³é¢‘æ•°æ®åˆ‡ç¢æ¥æé«˜ä¼ è¾“é€Ÿåº¦ï¼?

**ä¸æ˜¯**ã€‚è°ƒåº¦æœåŠ¡å™¨çš„å·¥ä½œæœºåˆ¶ï¼š

1. **ç´¯ç§¯ audio_chunk**ï¼?
   - Web ç«¯æ¯ 100ms å‘é€ä¸€ä¸?`audio_chunk`
   - è°ƒåº¦æœåŠ¡å™¨å°†æ‰€æœ?`audio_chunk` ç´¯ç§¯åˆ°åŒä¸€ä¸?`utterance_index` çš?buffer ä¸?

2. **Finalize è§¦å‘æ¡ä»¶**ï¼?
   - **Pause è¶…æ—¶**ï¼šå¦‚æ?`pause_ms` æ—¶é—´å†…ï¼ˆé»˜è®¤ 2000msï¼‰æ²¡æœ‰æ”¶åˆ°æ–°çš?`audio_chunk`ï¼Œè§¦å?finalize
   - **IsFinal æ ‡å¿—**ï¼šå¦‚æœæ”¶åˆ?`is_final=true` çš?`audio_chunk`ï¼Œç«‹å?finalize
   - **MaxLength ä¿æŠ¤**ï¼šå¦‚æœç´¯ç§¯çš„éŸ³é¢‘è¶…è¿‡ 500KBï¼Œè‡ªåŠ?finalizeï¼ˆå¼‚å¸¸ä¿æŠ¤ï¼‰

3. **Finalize æ‰§è¡Œ**ï¼?
   - è°ƒç”¨ `take_combined()` åˆå¹¶æ‰€æœ‰ç´¯ç§¯çš„ `audio_chunk`
   - åˆ›å»º job å¹¶å‘é€ç»™èŠ‚ç‚¹ç«?

**ç»“è®º**ï¼šè°ƒåº¦æœåŠ¡å™¨ä¸æ˜¯ä¸»åŠ¨åˆ‡ç¢éŸ³é¢‘ï¼Œè€Œæ˜¯æ ¹æ® pause è¶…æ—¶æœºåˆ¶æ?finalizeã€‚è¿™æ ·å¯ä»¥ï¼š
- ç­‰å¾…ç”¨æˆ·è¯´è¯ç»“æŸï¼ˆpause è¶…æ—¶ï¼?
- ä¸€æ¬¡æ€§å‘é€å®Œæ•´çš„ utteranceï¼Œé¿å…é¢‘ç¹åˆ›å»?job

---

### 3. å¦‚æœæŠŠç¼“å†²åŒºæé«˜åˆ?0ç§’ï¼Œä¼šä¸ä¼šé€ æˆè°ƒåº¦æœåŠ¡å™¨ä¹Ÿå‘é€?0ç§’çš„é•¿éŸ³é¢‘ï¼Ÿ

**ä¸ä¼š**ã€‚åŸå› ï¼š

1. **è°ƒåº¦æœåŠ¡å™¨çš„ finalize æœºåˆ¶æ˜¯ç‹¬ç«‹çš„**ï¼?
   - è°ƒåº¦æœåŠ¡å™¨æ ¹æ?`pause_ms` è¶…æ—¶æ?finalizeï¼ˆé»˜è®?2000ms = 2ç§’ï¼‰
   - ä¸å—èŠ‚ç‚¹ç«¯ç¼“å†²åŒºå¤§å°å½±å“

2. **å®é™…æµç¨‹**ï¼?
   ```
   Web ç«¯æŒç»­è¯´è¯?30 ç§?
     â†?
   è°ƒåº¦æœåŠ¡å™¨ç´¯ç§?audio_chunkï¼ˆæ¯ 100ms ä¸€ä¸ªï¼‰
     â†?
   ç”¨æˆ·åœæ­¢è¯´è¯ï¼Œpause_ms è¶…æ—¶ï¼?ç§’åï¼?
     â†?
   è°ƒåº¦æœåŠ¡å™?finalizeï¼Œåˆå¹¶æ‰€æœ?audio_chunkï¼ˆå¯èƒ½æ˜¯ 30 ç§’çš„éŸ³é¢‘ï¼?
     â†?
   å‘é€ç»™èŠ‚ç‚¹ç«¯ï¼ˆä¸€æ¬¡æ€§å‘é€å®Œæ•´çš„ 30 ç§’éŸ³é¢‘ï¼‰
     â†?
   èŠ‚ç‚¹ç«?OpusPacketDecodingPipeline è§£ç æ‰€æœ?packets
     â†?
   å¦‚æœèŠ‚ç‚¹ç«¯ç¼“å†²åŒºå®¹é‡è¶³å¤Ÿï¼?0ç§’ï¼‰ï¼Œå¯ä»¥å®Œæ•´ä¿å­˜æ‰€æœ‰è§£ç åçš„éŸ³é¢?
   ```

3. **èŠ‚ç‚¹ç«¯ç¼“å†²åŒºçš„ä½œç”?*ï¼?
   - **ä¸æ˜¯**é™åˆ¶è°ƒåº¦æœåŠ¡å™¨å‘é€çš„éŸ³é¢‘é•¿åº¦
   - **è€Œæ˜¯**é™åˆ¶èŠ‚ç‚¹ç«¯è§£ç åå¯ä»¥ä¿å­˜çš„éŸ³é¢‘é•¿åº?
   - å¦‚æœç¼“å†²åŒºå¤ªå°ï¼ˆ240msï¼‰ï¼Œè§£ç åçš„é•¿éŸ³é¢‘ä¼šè¢«ä¸¢å¼ƒï¼ˆé«˜æ°´ä½ç­–ç•¥ï¼‰

---

## ä¿®å¤æ–¹æ¡ˆ

### é—®é¢˜æ ¹æº

èŠ‚ç‚¹ç«¯çš„ `PCM16RingBuffer` å®¹é‡åªæœ‰ 240msï¼?840 samplesï¼‰ï¼Œå¯¼è‡´ï¼?
- è™½ç„¶è§£ç äº?40960 samplesï¼?.56ç§’ï¼‰
- ä½†ç¼“å†²åŒºå®¹é‡åªæœ‰ 3840 samplesï¼?40msï¼?
- è¶…å‡ºçš„æ•°æ®è¢«é«˜æ°´ä½ç­–ç•¥ä¸¢å¼?

### ä¿®å¤

1. **å¢åŠ  `OpusPacketDecodingPipeline` çš„é»˜è®¤ç¼“å†²åŒºå®¹é‡**ï¼?
   - ä»?`240ms` å¢åŠ åˆ?`30000ms`ï¼?0ç§’ï¼‰
   - æ–‡ä»¶ï¼š`opus_packet_decoder.py`

2. **åŒæ­¥æ›´æ–° `audio_decoder.py` ä¸­çš„ç¡¬ç¼–ç å€?*ï¼?
   - ä»?`240ms` å¢åŠ åˆ?`30000ms`
   - ç¡®ä¿ä¸¤ä¸ªåœ°æ–¹çš„å€¼ä¸€è‡?

### ä¿®æ”¹æ–‡ä»¶

1. `electron_node/services/faster_whisper_vad/opus_packet_decoder.py`:
   ```python
   buffer_capacity_ms: int = 30000  # 30ç§’å®¹é‡ï¼Œè¶³å¤Ÿå®¹çº³é•¿éŸ³é¢?
   ```

2. `electron_node/services/faster_whisper_vad/audio_decoder.py`:
   ```python
   buffer_capacity_ms=30000  # 30ç§’å®¹é‡ï¼Œä¸?opus_packet_decoder.py ä¿æŒä¸€è‡?
   ```

---

## éªŒè¯

ä¿®å¤åï¼ŒèŠ‚ç‚¹ç«¯åº”è¯¥èƒ½å¤Ÿï¼š
1. æ¥æ”¶è°ƒåº¦æœåŠ¡å™¨å‘é€çš„é•¿éŸ³é¢‘ï¼ˆä¾‹å¦‚ 30 ç§’ï¼‰
2. å®Œæ•´è§£ç æ‰€æœ?Opus packets
3. ä¿å­˜æ‰€æœ‰è§£ç åçš?PCM16 æ•°æ®ï¼ˆæœ€å¤?30 ç§’ï¼‰
4. å°†å®Œæ•´çš„éŸ³é¢‘ä¼ é€’ç»™ ASR æ¨¡å‹å¤„ç†

---

## æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**ï¼?
   - 30 ç§’çš„ PCM16 éŸ³é¢‘ï¼?6kHz, å•å£°é“ï¼‰â‰?30 * 16000 * 2 = 960KB
   - è¿™æ˜¯å¯æ¥å—çš„å†…å­˜å¼€é”€

2. **è°ƒåº¦æœåŠ¡å™¨çš„ pause_ms**ï¼?
   - é»˜è®¤æ˜?2000msï¼?ç§’ï¼‰
   - å¦‚æœç”¨æˆ·è¯´è¯è¿‡ç¨‹ä¸­æœ‰è¶…è¿‡ 2 ç§’çš„åœé¡¿ï¼Œè°ƒåº¦æœåŠ¡å™¨ä¼šæå‰?finalize
   - è¿™æ˜¯æ­£å¸¸çš„è¡Œä¸ºï¼Œä¸æ˜¯ bug

3. **é«˜æ°´ä½ç­–ç•?*ï¼?
   - `PCM16RingBuffer` çš„é«˜æ°´ä½ç­–ç•¥ä»ç„¶æœ‰æ•ˆ
   - å¦‚æœè§£ç åçš„éŸ³é¢‘è¶…è¿‡ 30 ç§’ï¼Œä»ç„¶ä¼šè¢«ä¸¢å¼ƒ
   - ä½†æ­£å¸¸æƒ…å†µä¸‹ï¼Œè°ƒåº¦æœåŠ¡å™¨ä¼šåœ¨ pause è¶…æ—¶å?finalizeï¼Œä¸ä¼šç´¯ç§¯è¶…è¿?30 ç§’çš„éŸ³é¢‘



---

## BITRATE_CONFIGURATION.md

# Opus æ¯”ç‰¹ç‡é…ç½?

**æ—¥æœŸ**: 2025-12-25  
**çŠ¶æ€?*: âœ?**å·²é…ç½®æ¨èæ¯”ç‰¹ç‡**

---

## é…ç½®æ€»ç»“

### Web ç«?âœ?

**æ–‡ä»¶**: `webapp/web-client/src/websocket_client.ts`

**é…ç½®**:
```typescript
const codecConfig: AudioCodecConfig = {
  codec: 'opus',
  sampleRate: 16000,
  channelCount: 1,
  frameSizeMs: 20,
  application: 'voip',
  bitrate: 24000, // âœ?24 kbps for VOIPï¼ˆæ¨èå€¼ï¼‰
};
```

**å®ç°**: `webapp/web-client/src/audio_codec.ts`
- åœ¨ç¼–ç å™¨åˆå§‹åŒ–åå°è¯•è®¾ç½®æ¯”ç‰¹ç?
- æ”¯æŒé€šè¿‡ `setBitrate()` æ–¹æ³•æˆ?`bitrate` å±æ€§è®¾ç½?
- å¦‚æœåº“ä¸æ”¯æŒï¼Œä¼šè®°å½•è­¦å‘Šä½†ç»§ç»­ä½¿ç”¨é»˜è®¤å€?

### èŠ‚ç‚¹ç«¯ï¼ˆæµ‹è¯•ä»£ç ï¼‰âœ…

**æ–‡ä»¶**: `electron_node/services/faster_whisper_vad/test_integration_wav.py`

**é…ç½®**:
```python
# è®¾ç½®æ¯”ç‰¹ç‡ä¸º 24 kbpsï¼ˆä¸ Web ç«¯ä¸€è‡´ï¼‰
bitrate = 24000  # 24 kbps
error = opus.opus_encoder_ctl(
    opus.cast(opus.pointer(encoder_state), opus.oe_p),
    opus.OPUS_SET_BITRATE_REQUEST,
    bitrate
)
```

**æ³¨æ„**: 
- èŠ‚ç‚¹ç«¯çš„è§£ç å™¨ä¸éœ€è¦è®¾ç½®æ¯”ç‰¹ç‡ï¼ˆè‡ªåŠ¨ä» packet è¯»å–ï¼?
- åªæœ‰æµ‹è¯•ä»£ç ä¸­çš„ç¼–ç å™¨éœ€è¦è®¾ç½®ï¼Œç¡®ä¿ä¸?Web ç«¯ä¸€è‡?

---

## æ¯”ç‰¹ç‡é€‰æ‹©

### æ¨èå€¼ï¼š24 kbps

**åŸå› **:
- âœ?**å¹³è¡¡è´¨é‡å’Œå¸¦å®?*: 16-32 kbps æ˜?VOIP çš„æ¨èèŒƒå›?
- âœ?**é€‚åˆçŸ­éŸ³é¢?*: å¯¹äº 0.24 ç§’çš„çŸ­éŸ³é¢‘ï¼Œ24 kbps æä¾›æ›´å¥½çš„è´¨é‡?
- âœ?**ç½‘ç»œå‹å¥½**: ä¸ä¼šå ç”¨è¿‡å¤šå¸¦å®½
- âœ?**è´¨é‡ä¿è¯**: è¶³å¤Ÿæ”¯æŒæ¸…æ™°çš„è¯­éŸ³è¯†åˆ?

### å…¶ä»–é€‰é¡¹

- **16 kbps**: æœ€ä½æ¨èå€¼ï¼Œå¸¦å®½æ›´çœï¼Œä½†è´¨é‡ç•¥ä½
- **32 kbps**: æ›´é«˜è´¨é‡ï¼Œä½†å¸¦å®½å ç”¨æ›´é«˜
- **é»˜è®¤ï¼?4 kbpsï¼?*: å¯¹çŸ­éŸ³é¢‘å¯èƒ½ä¸å‹å¥½ï¼Œå¯¼è‡´è´¨é‡ä¸‹é™

---

## éªŒè¯

### Web ç«?

1. **æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—**:
   ```
   OpusEncoder initialized { sampleRate: 16000, application: 'voip', bitrate: 24000 }
   OpusEncoder bitrate set to 24000 bps
   ```

2. **å¦‚æœåº“ä¸æ”¯æŒè®¾ç½®æ¯”ç‰¹ç?*:
   ```
   OpusEncoder initialized { sampleRate: 16000, application: 'voip', bitrate: 'default' }
   OpusEncoder does not support setting bitrate, using default
   ```

### èŠ‚ç‚¹ç«¯ï¼ˆæµ‹è¯•ï¼?

1. **æ£€æŸ¥æ—¥å¿?*:
   ```
   Opus encoder bitrate set to 24000 bps (24 kbps for VOIP)
   ```

2. **å¦‚æœè®¾ç½®å¤±è´¥**:
   ```
   Failed to set Opus encoder bitrate to 24000 bps: [error message]
   ```

---

## é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰?

- éŸ³é¢‘è´¨é‡å·®ï¼ˆstd: 0.0121-0.0898ï¼?
- ASR æ— æ³•è¯†åˆ«ï¼Œè¿”å›ç©ºæ–‡æœ¬
- èŠ‚ç‚¹ç«¯ç»§ç»­è°ƒç”?NMT/TTSï¼Œç”Ÿæˆ?"The" è¯­éŸ³

### ä¿®å¤å?

- âœ?éŸ³é¢‘è´¨é‡æ”¹å–„ï¼ˆstd åº”è¯¥ > 0.1ï¼?
- âœ?ASR èƒ½å¤Ÿè¯†åˆ«ï¼Œè¿”å›æœ‰æ„ä¹‰çš„æ–‡æœ?
- âœ?ä¸å†ç”Ÿæˆ "The" è¯­éŸ³

---

## ä¸‹ä¸€æ­?

1. âœ?**é‡æ–°ç¼–è¯‘ Web ç«?*
   ```bash
   cd webapp/web-client
   npm run build
   ```

2. âœ?**é‡å¯ Web ç«¯æœåŠ?*
   - åº”ç”¨æ–°çš„æ¯”ç‰¹ç‡é…ç½?

3. âœ?**æµ‹è¯•éªŒè¯**
   - éªŒè¯éŸ³é¢‘è´¨é‡æ˜¯å¦æ”¹å–„
   - éªŒè¯ ASR è¯†åˆ«ç‡æ˜¯å¦æé«?
   - éªŒè¯ä¸å†ç”Ÿæˆ "The" è¯­éŸ³

---

**é…ç½®å®Œæˆæ—¶é—´**: 2025-12-25  
**çŠ¶æ€?*: âœ?**å·²é…ç½®æ¨èæ¯”ç‰¹ç‡ï¼?4 kbps for VOIPï¼?*



---

## BITRATE_FIX_SUMMARY.md

# Opus æ¯”ç‰¹ç‡é…ç½®ä¿®å¤æ€»ç»“

**æ—¥æœŸ**: 2025-12-25  
**çŠ¶æ€?*: âœ?**å·²é…ç½®æ¨èæ¯”ç‰¹ç‡ï¼?4 kbps for VOIPï¼?*

---

## ä¿®å¤å†…å®¹

### 1. Web ç«?âœ?

**æ–‡ä»¶**: `webapp/web-client/src/websocket_client.ts`

**ä¿®æ”¹**:
```typescript
bitrate: 24000, // âœ?è®¾ç½® 24 kbps for VOIPï¼ˆæ¨èå€¼ï¼Œå¹³è¡¡è´¨é‡å’Œå¸¦å®½ï¼‰
```

**æ–‡ä»¶**: `webapp/web-client/src/audio_codec.ts`

**ä¿®æ”¹**:
- åœ¨ç¼–ç å™¨åˆå§‹åŒ–åå°è¯•è®¾ç½®æ¯”ç‰¹ç?
- æ”¯æŒé€šè¿‡ `setBitrate()` æ–¹æ³•æˆ?`bitrate` å±æ€§è®¾ç½?
- å¦‚æœåº“ä¸æ”¯æŒï¼Œä¼šè®°å½•è­¦å‘Šä½†ç»§ç»­ä½¿ç”¨é»˜è®¤å€?

### 2. èŠ‚ç‚¹ç«¯ï¼ˆæµ‹è¯•ä»£ç ï¼‰âœ…

**æ›´æ–°çš„æ–‡ä»?*:
1. `test_integration_wav.py` - é›†æˆæµ‹è¯•
2. `test_service_unit.py` - å•å…ƒæµ‹è¯•
3. `test_plan_a_e2e.py` - ç«¯åˆ°ç«¯æµ‹è¯?
4. `test_opus_quick.py` - å¿«é€Ÿæµ‹è¯?

**ä¿®æ”¹**:
```python
# è®¾ç½®æ¯”ç‰¹ç‡ä¸º 24 kbpsï¼ˆä¸ Web ç«¯ä¸€è‡´ï¼‰
bitrate = 24000  # 24 kbps
error = opus.opus_encoder_ctl(
    opus.cast(opus.pointer(encoder_state), opus.oe_p),
    opus.OPUS_SET_BITRATE_REQUEST,
    bitrate
)
```

---

## æ¯”ç‰¹ç‡é€‰æ‹©

### æ¨èå€¼ï¼š24 kbps

**åŸå› **:
- âœ?**å¹³è¡¡è´¨é‡å’Œå¸¦å®?*: 16-32 kbps æ˜?VOIP çš„æ¨èèŒƒå›?
- âœ?**é€‚åˆçŸ­éŸ³é¢?*: å¯¹äº 0.24 ç§’çš„çŸ­éŸ³é¢‘ï¼Œ24 kbps æä¾›æ›´å¥½çš„è´¨é‡?
- âœ?**ç½‘ç»œå‹å¥½**: ä¸ä¼šå ç”¨è¿‡å¤šå¸¦å®½
- âœ?**è´¨é‡ä¿è¯**: è¶³å¤Ÿæ”¯æŒæ¸…æ™°çš„è¯­éŸ³è¯†åˆ?

### å¯¹æ¯”

| æ¯”ç‰¹ç?| è´¨é‡ | å¸¦å®½ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|----------|
| 16 kbps | ä¸­ç­‰ | ä½?| æœ€ä½æ¨èå€?|
| **24 kbps** | **è‰¯å¥½** | **ä¸­ç­‰** | **æ¨èå€¼ï¼ˆå·²é…ç½®ï¼‰** |
| 32 kbps | é«?| è¾ƒé«˜ | æ›´é«˜è´¨é‡ |
| 64 kbpsï¼ˆé»˜è®¤ï¼‰ | é«?| é«?| å¯¹çŸ­éŸ³é¢‘ä¸å‹å¥?|

---

## é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰?

- â?ä½¿ç”¨é»˜è®¤æ¯”ç‰¹ç‡ï¼ˆ64 kbpsï¼?
- â?éŸ³é¢‘è´¨é‡å·®ï¼ˆstd: 0.0121-0.0898ï¼?
- â?ASR æ— æ³•è¯†åˆ«ï¼Œè¿”å›ç©ºæ–‡æœ¬
- â?èŠ‚ç‚¹ç«¯ç»§ç»­è°ƒç”?NMT/TTSï¼Œç”Ÿæˆ?"The" è¯­éŸ³

### ä¿®å¤å?

- âœ?ä½¿ç”¨æ¨èæ¯”ç‰¹ç‡ï¼ˆ24 kbpsï¼?
- âœ?éŸ³é¢‘è´¨é‡æ”¹å–„ï¼ˆstd åº”è¯¥ > 0.1ï¼?
- âœ?ASR èƒ½å¤Ÿè¯†åˆ«ï¼Œè¿”å›æœ‰æ„ä¹‰çš„æ–‡æœ?
- âœ?ä¸å†ç”Ÿæˆ "The" è¯­éŸ³

---

## éªŒè¯æ­¥éª¤

### 1. Web ç«?

**æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—**:
```
OpusEncoder initialized { sampleRate: 16000, application: 'voip', bitrate: 24000 }
OpusEncoder bitrate set to 24000 bps
```

**å¦‚æœåº“ä¸æ”¯æŒ**:
```
OpusEncoder initialized { sampleRate: 16000, application: 'voip', bitrate: 'default' }
OpusEncoder does not support setting bitrate, using default
```

### 2. èŠ‚ç‚¹ç«¯ï¼ˆæµ‹è¯•ï¼?

**æ£€æŸ¥æ—¥å¿?*:
```
Opus encoder bitrate set to 24000 bps (24 kbps for VOIP)
```

### 3. ASR æœåŠ¡

**æ£€æŸ¥éŸ³é¢‘è´¨é‡æŒ‡æ ?*:
```
Audio data validation: 
std=0.15,  # âœ?åº”è¯¥ > 0.1ï¼ˆä¹‹å‰æ˜¯ 0.0121-0.0898ï¼?
rms=0.08,  # âœ?åº”è¯¥ > 0.01
dynamic_range=0.5,  # âœ?åº”è¯¥ > 0.05
```

---

## ä¸‹ä¸€æ­?

1. âœ?**é‡æ–°ç¼–è¯‘ Web ç«?*
   ```bash
   cd webapp/web-client
   npm run build
   ```

2. âœ?**é‡å¯ Web ç«¯æœåŠ?*
   - åº”ç”¨æ–°çš„æ¯”ç‰¹ç‡é…ç½?

3. âœ?**æµ‹è¯•éªŒè¯**
   - éªŒè¯éŸ³é¢‘è´¨é‡æ˜¯å¦æ”¹å–„
   - éªŒè¯ ASR è¯†åˆ«ç‡æ˜¯å¦æé«?
   - éªŒè¯ä¸å†ç”Ÿæˆ "The" è¯­éŸ³

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-25  
**çŠ¶æ€?*: âœ?**å·²é…ç½®æ¨èæ¯”ç‰¹ç‡ï¼?4 kbps for VOIPï¼?*

**æ³¨æ„**: 
- Web ç«¯éœ€è¦é‡æ–°ç¼–è¯‘å’Œé‡å¯
- èŠ‚ç‚¹ç«¯æµ‹è¯•ä»£ç å·²æ›´æ–°ï¼Œä¸‹æ¬¡æµ‹è¯•æ—¶ä¼šä½¿ç”¨æ–°é…ç½®
- è§£ç ç«¯ä¸éœ€è¦è®¾ç½®æ¯”ç‰¹ç‡ï¼ˆè‡ªåŠ¨ä» packet è¯»å–ï¼?



---

## FIX_AUDIO_CHUNK_FORMAT.md

# ä¿®å¤audio_chunkæ ¼å¼é—®é¢˜

**æ—¥æœŸ**: 2025-12-24  
**ä¿®å¤**: Webç«¯`sendAudioChunk()`ä½¿ç”¨Plan Aæ ¼å¼  
**çŠ¶æ€?*: âœ?**å·²å®Œæˆ?*

---

## é—®é¢˜æ€»ç»“

### å‘ç°çš„é—®é¢?

1. **Webç«¯ä½¿ç”¨ä¸¤ç§æ¶ˆæ¯ç±»å?*ï¼?
   - `audio_chunk`æ¶ˆæ¯ï¼šæµå¼å‘é€ï¼Œä½¿ç”¨`encode()`æ–¹æ³•ï¼ˆè¿ç»­å­—èŠ‚æµï¼‰âŒ
   - `utterance`æ¶ˆæ¯ï¼šä¸€æ¬¡æ€§å‘é€ï¼Œä½¿ç”¨`encodePackets()`æ–¹æ³•ï¼ˆpacketæ ¼å¼ï¼‰âœ…

2. **è°ƒåº¦æœåŠ¡å™¨å¤„ç†æ–¹å¼?*ï¼?
   - `audio_chunk` â†?`audio_buffer` â†?finalize â†?jobï¼ˆè¿ç»­å­—èŠ‚æµï¼?
   - `utterance` â†?ç›´æ¥åˆ›å»ºjobï¼ˆpacketæ ¼å¼ï¼?

3. **ç»“æœ**ï¼?
   - ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼ˆ`utterance`æ¶ˆæ¯ï¼‰ï¼šæˆåŠŸæ£€æµ‹åˆ°packetæ ¼å¼ âœ?
   - åç»­è¯·æ±‚ï¼ˆ`audio_chunk`æ¶ˆæ¯åˆå¹¶ï¼‰ï¼šæ£€æµ‹ä¸åˆ°packetæ ¼å¼ â?

---

## ä¿®å¤å†…å®¹

### ä¿®æ”¹æ–‡ä»¶

**æ–‡ä»¶**: `webapp/web-client/src/websocket_client.ts`

**æ–¹æ³•**: `sendAudioChunkJSON()`

### ä¿®å¤å‰?

```typescript
// â?ä½¿ç”¨ encode() æ–¹æ³•ï¼Œç”Ÿæˆè¿ç»­å­—èŠ‚æµ
encodedAudio = await this.audioEncoder.encode(audioData);
```

### ä¿®å¤å?

```typescript
// âœ?ä½¿ç”¨ encodePackets() æ–¹æ³•ï¼ˆPlan Aæ ¼å¼ï¼?
const opusPackets = await encoder.encodePackets(audioData);

// âœ?ä¸ºæ¯ä¸ªpacketæ·»åŠ é•¿åº¦å‰ç¼€ï¼ˆPlan Aæ ¼å¼ï¼?
for (const packet of opusPackets) {
  const lenBuffer = new ArrayBuffer(2);
  const lenView = new DataView(lenBuffer);
