# 查看三个新服务的日志说明

## 概述

三个新服务（semantic-repair-zh, semantic-repair-en, en-normalize）的日志输出到控制台（stdout/stderr），但可能没有被完全捕获到主进程日志中。

## 服务状态

从主进程日志可以看到，这些服务都在运行：
- `semantic-repair-zh:running` (端口 5013)
- `semantic-repair-en:running` (端口 5011)
- `en-normalize:running` (端口 5012)

## 服务调用情况

从主进程日志中的 `PostProcessCoordinator` 日志可以看到：

### 测试会话：s-39841BE8

**示例1：**
```
job-50B400D5: semanticRepairApplied=false, semanticRepairConfidence=0.8
输入：现在让我们测试一下这个版本的系统
输出：Now let's test this version of the system.
```

**示例2：**
```
job-13129823: semanticRepairApplied=false, semanticRepairConfidence=0.8857142857142857
输入：看看原因能不能证据的发送然后能不能证据的返回也就这点目标了其他的报错可能会有
输出：to see why the evidence can be sent and then the return of the evidence may also be targeted by the
```

**示例3：**
```
job-6922583E: semanticRepairApplied=false, semanticRepairConfidence=1
输入：有一些東西會重複 但是問題不大 感覺反彙速度也還可以
输出：There are some things that will repeat but the problem is not big.
```

**示例4：**
```
job-83C58C3A: semanticRepairApplied=false, semanticRepairConfidence=1
输入：不大 感覺反彙速度也會重複 但是問題不大
输出：not much the sensations reboots speed will also be repeating but the issue is not big.
```

## 问题分析

### 1. 为什么 `semanticRepairApplied=false`？

从日志可以看到，所有请求的 `semanticRepairApplied` 都是 `false`，说明：
- 服务被调用了（有 `semanticRepairConfidence` 值）
- 但服务决定不应用修复（`decision=PASS`）

这可能是因为：
- 文本质量已经足够好，不需要修复
- 或者服务的修复逻辑判断文本不需要修复

### 2. 为什么看不到 INPUT/OUTPUT 日志？

服务的 INPUT/OUTPUT 日志应该包含：
- `SEMANTIC_REPAIR_ZH INPUT: Received repair request | job_id=xxx | ...`
- `SEMANTIC_REPAIR_ZH OUTPUT: Repair completed | job_id=xxx | ...`

这些日志输出到服务的 stdout，但可能：
1. 没有被正确捕获到主进程日志
2. 或者日志级别设置问题

## 如何查看服务的详细日志

### 方法1：直接查看服务进程的输出

服务的日志输出到 stdout/stderr，可以通过以下方式查看：

1. **查看主进程日志中的 Service stdout/stderr**
   ```powershell
   Get-Content "electron_node\electron-node\logs\electron-main.log" | Select-String -Pattern "Service stdout" | Select-String -Pattern "SEMANTIC_REPAIR|EN_NORMALIZE"
   ```

2. **直接启动服务查看日志**
   ```powershell
   # 中文语义修复服务
   cd electron_node\services\semantic_repair_zh
   python semantic_repair_zh_service.py
   
   # 英文语义修复服务
   cd electron_node\services\semantic_repair_en
   python semantic_repair_en_service.py
   
   # 英文标准化服务
   cd electron_node\services\en_normalize
   python en_normalize_service.py
   ```

### 方法2：使用日志捕获脚本

中文语义修复服务提供了日志捕获脚本：
```powershell
cd electron_node\services\semantic_repair_zh
.\capture_startup_logs.ps1
```

### 方法3：通过主进程日志查看调用情况

虽然看不到服务的详细 INPUT/OUTPUT 日志，但可以通过主进程日志查看：
- 服务是否被调用
- 修复是否被应用
- 修复的置信度

```powershell
Get-Content "electron_node\electron-node\logs\electron-main.log" | Select-String -Pattern "PostProcessCoordinator.*semantic" | Select-Object -Last 20
```

## 修复效果分析

从测试日志可以看到：

### 中文语义修复服务（semantic-repair-zh）

**调用情况：**
- 所有中文文本都经过了语义修复服务
- 但所有请求的 `semanticRepairApplied=false`，说明服务判断文本不需要修复

**可能的原因：**
- 文本质量已经足够好（quality_score 较高）
- 或者服务的修复逻辑比较保守

### 英文语义修复服务（semantic-repair-en）

**调用情况：**
- 英文文本（NMT 翻译后的结果）应该经过英文语义修复服务
- 但从日志中看不到英文语义修复的调用记录

**可能的原因：**
- 英文语义修复服务在 NMT 之后调用，但日志中没有记录
- 或者服务没有被正确调用

### 英文标准化服务（en-normalize）

**调用情况：**
- 英文文本应该经过标准化服务
- 但从日志中看不到标准化服务的调用记录

**可能的原因：**
- 标准化服务在 NMT 之后调用，但日志中没有记录
- 或者服务没有被正确调用

## 建议

1. **检查服务是否正确调用**
   - 查看 `PostProcessCoordinator` 的日志，确认服务是否被调用
   - 检查服务的健康状态

2. **查看服务的实际输出**
   - 直接启动服务，查看 stdout/stderr 输出
   - 或者修改服务，将日志写入文件

3. **改进日志捕获**
   - 修改服务管理器，更好地捕获服务的 stdout/stderr
   - 或者让服务直接写入日志文件

## 下一步

1. 检查服务的实际调用流程
2. 确认服务的 INPUT/OUTPUT 日志是否被正确记录
3. 如果需要，修改日志捕获机制，确保能看到服务的详细日志
