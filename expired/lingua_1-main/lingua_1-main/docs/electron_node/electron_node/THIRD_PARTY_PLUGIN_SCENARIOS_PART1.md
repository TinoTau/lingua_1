# 第三方插件接入场景与流程（第一部分：概述与场景）

> 本文档分为两部分，第一部分介绍概述和场景分类，第二部分介绍接入流程和示例

## 概述

本文档说明在插件化架构下，第三方插件可能的接入场景、类型和流程。**注意**：当前系统使用模块化热插拔体系，插件化架构是未来扩展方案。

## ⚠️ 核心设计理念

**本项目核心目标**：利用个人PC的闲置算力（GPU/CPU）提供翻译服务，而不是作为转接服务调用外部云API。

**设计原则**：
- ✅ **本地算力优先**：所有核心推理工作应在节点本地完成
- ✅ **GPU资源利用**：充分利用节点本地GPU资源
- ✅ **数据隐私保护**：用户数据不离开本地节点
- ❌ **禁止转接服务**：不应将节点变成调用外部云API的转接服务
- ❌ **禁止远程推理**：核心推理工作不应依赖远程服务

**第三方插件必须遵循此设计理念**。

---

## 1. 第三方插件场景

### 1.1 场景分类

#### 场景 A：替代现有服务（本地模型）

**场景描述**：第三方提供更好的本地 ASR/NMT/TTS 模型，希望替换或补充现有服务。

**示例**：
- **ASR 替代**：使用更先进的本地 Whisper 变体或自定义 ASR 模型
- **NMT 替代**：使用更先进的本地翻译模型（如更大的 M2M100 模型、本地部署的 LLM）
- **TTS 替代**：使用更先进的本地 TTS 模型（如更高质量的 VITS 模型）

**适用场景**：
- 第三方有更先进的本地模型文件
- 需要特定语言/方言支持
- 需要更高的准确率
- 模型可以在本地 GPU 上运行

**❌ 不符合设计理念的场景**：
- ~~使用 Google Cloud Speech-to-Text API 替代 Whisper~~（转接服务）
- ~~使用 OpenAI GPT-4 翻译 API 替代 M2M100~~（转接服务）
- ~~使用 Azure Neural TTS 替代 Piper TTS~~（转接服务）

#### 场景 B：扩展新功能（本地处理）

**场景描述**：第三方提供系统当前不支持的新功能模块，使用本地算力处理。

**示例**：
- **情感分析**：使用本地 BERT 模型分析语音情感
- **语音增强**：使用本地模型进行降噪、回声消除
- **方言识别**：使用本地模型识别方言类型
- **语速控制**：使用本地模型调整 TTS 语速

**适用场景**：
- 需要扩展系统功能
- 功能可以在本地 GPU/CPU 上运行
- 数据隐私要求高

#### 场景 C：优化现有功能（本地处理）

**场景描述**：第三方提供优化现有功能的插件，使用本地算力处理。

**示例**：
- **VAD 优化**：使用更先进的本地 VAD 模型
- **语言检测优化**：使用更准确的本地语言检测模型
- **音频预处理**：使用本地模型进行音频增强

**适用场景**：
- 需要优化现有功能性能
- 优化可以在本地完成
- 不影响核心流程

---

## 2. 插件类型

### 2.1 服务插件（Service Plugin）

**定义**：提供独立服务的插件，通过 HTTP 接口提供服务。

**特点**：
- 作为独立进程运行
- 通过 `localhost` HTTP 接口提供服务
- 可以替代或补充现有服务（ASR/NMT/TTS）
- 支持本地和远程部署模式

**部署模式**：
- **本地服务插件**：完全本地运行，使用本地 GPU/CPU
- **远程服务插件**：本地包装器，调用远程 API（不推荐，违反设计理念）

### 2.2 功能插件（Feature Plugin）

**定义**：提供新功能的插件，不替代现有服务。

**特点**：
- 作为独立进程运行
- 通过 `localhost` HTTP 接口提供服务
- 依赖现有服务（如 ASR、NMT）
- 扩展系统功能

**部署模式**：
- **本地功能插件**：完全本地运行，使用本地 GPU/CPU

---

## 3. 插件接入要求

### 3.1 必须要求

1. **本地算力优先**：所有核心推理工作应在节点本地完成
2. **GPU资源利用**：充分利用节点本地GPU资源
3. **数据隐私保护**：用户数据不离开本地节点
4. **接口兼容**：必须实现标准的 HTTP 接口
5. **健康检查**：必须提供健康检查端点
6. **资源监控**：必须支持资源使用监控

### 3.2 禁止要求

1. **禁止转接服务**：不应将节点变成调用外部云API的转接服务
2. **禁止远程推理**：核心推理工作不应依赖远程服务
3. **禁止数据外传**：用户数据不应离开本地节点

---

## 相关文档

- [第三方插件接入流程（第二部分）](./THIRD_PARTY_PLUGIN_SCENARIOS_PART2.md) - 接入流程和示例
- [插件架构评估](./PLUGIN_ARCHITECTURE_NECESSITY_ASSESSMENT.md) - 插件架构必要性评估
- [模块化功能文档](../modular/README.md) - 当前模块化热插拔体系

