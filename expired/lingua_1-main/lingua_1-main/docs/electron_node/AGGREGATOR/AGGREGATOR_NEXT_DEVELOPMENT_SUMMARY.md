# Aggregator 下一步开发内容总结

**最后更新**：2025-01-XX  
**当前状态**：✅ P0 已完成，P1 部分完成

---

## 已完成内容

### P0 核心功能 ✅

- ✅ 核心决策逻辑（Text Incompleteness Score + Language Stability Gate）
- ✅ Dedup（边界重叠裁剪）
- ✅ Tail Carry（尾巴延迟归属）
- ✅ 会话态管理（per session）
- ✅ gap_ms 计算（从 segments 推导）
- ✅ 中间件集成（NodeAgent）

### P0 优化 ✅

- ✅ 功能测试与验证
- ✅ 参数调优
- ✅ 单元测试完善
- ✅ 重新触发 NMT
- ✅ 缓存机制和上下文传递
- ✅ 文本截断问题修复
- ✅ NMT 性能优化（缓存、异步处理、批量处理）
- ✅ 重复发送问题修复

### P1 增强功能（部分完成）

- ✅ NMT Repair（AGG-10）
  - ✅ NMT 候选生成（基于 beam search）
  - ✅ 候选打分机制
  - ✅ 同音字检测和修复
  - ✅ 同音字自动学习

---

## 待开发内容

### P1 增强功能（可选）

#### 1. Glossary/专名/数字保护（AGG-11）⚠️

**功能描述**：
- 在 NMT Repair 中保护 glossary 词
- 保护专名和数字不被修改
- 与 NMT Repair 配合使用

**复杂度**：中  
**预计工作量**：1 周  
**优先级**：🟡 中

**依赖**：
- ✅ NMT Repair（已完成）

**触发条件**：
- 如果 NMT Repair 误修改了专名或数字
- 如果用户需要保护特定的术语

**判断标准**：
- 如果 NMT Repair 没有误修改专名或数字 → 不需要
- 如果出现了误修改 → 需要实现

**建议**：先观察实际使用情况，根据错误报告决定

---

#### 2. Partial Results 处理 ⚠️

**功能描述**：
- 处理 `is_final: false` 的 partial results
- 使用更保守的 merge 策略
- 避免 partial results 导致的抖动

**复杂度**：中  
**预计工作量**：1-2 周  
**优先级**：🟢 低

**依赖**：无

**触发条件**：
- 如果需要更快的响应（< 500ms）
- 如果用户需要实时看到识别结果

**判断标准**：
- 如果 final 结果的处理速度已满足需求 → 不需要
- 如果需要更快的响应（< 500ms）→ 考虑实现

**建议**：先观察实际使用情况，根据延迟需求决定

---

#### 3. A/B 调参框架（AGG-12）⚠️

**功能描述**：
- 配置下发机制
- 回放评测框架
- 参数对比分析

**复杂度**：中  
**预计工作量**：1-2 周  
**优先级**：🟢 低

**依赖**：无

**触发条件**：
- 如果需要自动化调参
- 如果需要对比不同参数的效果

**判断标准**：
- 如果手动调参已足够 → 不需要
- 如果需要自动化调参 → 考虑实现

**建议**：初期可以手动调参，后续根据需求决定

---

#### 4. 失败模式回放用例集（AGG-13）⚠️

**功能描述**：
- 收集典型失败场景的测试用例
- 包含夹杂语言、手动截断、停顿等场景
- 用于回归测试

**复杂度**：低  
**预计工作量**：3-5 天  
**优先级**：🟢 低

**依赖**：无

**触发条件**：
- 需要回归测试
- 需要验证修复效果

**判断标准**：
- 可以逐步积累
- 不需要一次性完成

**建议**：逐步积累，不需要一次性完成

---

## 推荐开发顺序

### 阶段 1：观察期（1-2 周）

1. **收集用户反馈**
   - 分析性能数据
   - 识别问题场景
   - 确认是否需要 Glossary 保护

2. **根据反馈决定开发顺序**
   - 如果出现误修改 → 优先开发 Glossary 保护
   - 如果需要更快响应 → 优先开发 Partial Results 处理
   - 如果需要自动化调参 → 考虑开发 A/B 调参框架

### 阶段 2：功能开发（根据需求）

1. **Glossary/专名/数字保护**（1 周）
   - 如果 NMT Repair 误修改了专名或数字
   - 优先级：🟡 中

2. **Partial Results 处理**（1-2 周）
   - 如果需要更快的响应（< 500ms）
   - 优先级：🟢 低

3. **A/B 调参框架**（1-2 周）
   - 如果需要自动化调参
   - 优先级：🟢 低

4. **失败模式用例集**（3-5 天）
   - 逐步积累
   - 优先级：🟢 低

---

## 工作量估算

### P1 剩余工作

| 任务 | 工作量 | 优先级 | 状态 |
|------|--------|--------|------|
| Glossary/专名/数字保护 | 1 周 | 🟡 中 | ⚠️ 待开发 |
| Partial Results 处理 | 1-2 周 | 🟢 低 | ⚠️ 待开发 |
| A/B 调参框架 | 1-2 周 | 🟢 低 | ⚠️ 待开发 |
| 失败模式用例集 | 3-5 天 | 🟢 低 | ⚠️ 待开发 |

**P1 剩余总工作量**：约 3-5 周（如果全部实现）

---

## 关键决策点

### 是否需要 Glossary 保护？

**判断标准**：
- 如果 NMT Repair 没有误修改专名或数字 → 不需要
- 如果出现了误修改 → 需要实现

**建议**：先观察实际使用情况，根据错误报告决定

### 是否需要 Partial Results 处理？

**判断标准**：
- 如果 final 结果的处理速度已满足需求 → 不需要
- 如果需要更快的响应（< 500ms）→ 考虑实现

**建议**：先观察实际使用情况，根据延迟需求决定

### 是否需要 A/B 调参框架？

**判断标准**：
- 如果手动调参已足够 → 不需要
- 如果需要自动化调参 → 考虑实现

**建议**：初期可以手动调参，后续根据需求决定

---

## 总结

### 当前状态

✅ **P0 核心功能已完成**（100%）  
✅ **P0 优化已完成**（单元测试、重新触发 NMT、性能优化）  
✅ **NMT Repair 已完成**（同音字检测、修复、自动学习）  
⏸️ **其他 P1 增强功能待定**（根据实际需求决定）

### 下一步行动

1. **观察实际使用情况**（1-2 周）
   - 收集用户反馈
   - 分析性能数据
   - 识别问题场景

2. **根据反馈决定开发顺序**
   - 如果出现误修改 → Glossary 保护
   - 如果需要更快响应 → Partial Results 处理
   - 如果需要自动化调参 → A/B 调参框架

3. **逐步积累用例集**
   - 不需要一次性完成
   - 可以逐步积累

---

## 相关文档

- `AGGREGATOR_P1_TASKS_SUMMARY.md` - P1 任务详细说明
- `AGGREGATOR_OPTIMIZATION_AND_REMAINING_WORK.md` - 优化与剩余工作
- `AGGREGATOR_NMT_REPAIR_IMPLEMENTATION.md` - NMT Repair 实现文档

