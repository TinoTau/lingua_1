# Aggregator 下一步开发计划

**最后更新**：2025-01-XX  
**当前状态**：✅ P0 已完成，NMT Repair 已完成

---

## 当前完成状态

### ✅ P0 核心功能（100% 完成）

- ✅ 核心决策逻辑（Text Incompleteness Score + Language Stability Gate）
- ✅ Dedup（边界重叠裁剪）
- ✅ Tail Carry（尾巴延迟归属）
- ✅ 会话态管理（per session）
- ✅ gap_ms 计算（从 segments 推导）
- ✅ 中间件集成（NodeAgent）

### ✅ P0 优化（100% 完成）

- ✅ 功能测试与验证
- ✅ 参数调优（多轮优化）
- ✅ 单元测试完善
- ✅ 重新触发 NMT
- ✅ 缓存机制和上下文传递
- ✅ 文本截断问题修复

### ✅ P1 增强功能（部分完成）

- ✅ **NMT Repair**（已完成）
  - NMT 候选生成
  - 候选打分机制
  - 同音字检测和修复
  - 同音字自动学习

---

## 下一步开发建议

### 优先级 1：性能优化（可选，1-2 周）

#### 1. NMT 重新翻译性能优化

**当前状态**：
- 平均延迟：1077.67ms（目标 < 500ms）
- 缓存机制已实现，但可能需要进一步优化

**优化方向**：
- [ ] 优化缓存策略（更智能的缓存键生成）
- [ ] 异步处理（如果延迟要求不高）
- [ ] 批量处理（如果多个 utterance 同时聚合）

**预计工作量**：3-5 天

#### 2. 同音字学习优化

**当前状态**：
- 基础学习机制已实现
- 差异检测算法较简化（只支持单词替换）

**优化方向**：
- [ ] 改进差异检测算法（支持多词替换）
- [ ] 添加学习模式验证机制
- [ ] 支持上下文相关的同音字修复

**预计工作量**：3-5 天

---

### 优先级 2：功能增强（可选，根据需求）

#### 1. Partial Results 处理

**功能描述**：
- 处理 `is_final: false` 的 partial results
- 使用更保守的 merge 策略
- 避免 partial results 导致的抖动

**复杂度**：中  
**预计工作量**：1-2 周

**判断标准**：
- 如果 final 结果的处理速度已满足需求 → 不需要
- 如果需要更快的响应（< 500ms）→ 考虑实现

**优先级**：低（P0 只处理 final 结果已足够）

---

#### 2. Glossary/专名/数字保护

**功能描述**：
- 在 NMT Repair 中保护 glossary 词
- 保护专名和数字不被修改
- 与 NMT Repair 配合使用

**复杂度**：中  
**预计工作量**：1 周

**依赖**：需要先实现 NMT Repair（✅ 已完成）

**优先级**：中（如果 NMT Repair 误修改了专名或数字）

---

#### 3. A/B 调参框架

**功能描述**：
- 配置下发机制
- 回放评测框架
- 参数对比分析

**复杂度**：中  
**预计工作量**：1-2 周

**优先级**：低（初期可以手动调参）

---

#### 4. 失败模式回放用例集

**功能描述**：
- 收集典型失败场景的测试用例
- 包含夹杂语言、手动截断、停顿等场景
- 用于回归测试

**复杂度**：低  
**预计工作量**：3-5 天

**优先级**：低（可以逐步积累）

---

## 推荐开发顺序

### 阶段 1：性能优化（可选，1-2 周）

1. **NMT 重新翻译性能优化**（3-5 天）
   - 优化缓存策略
   - 考虑异步处理
   - 批量处理优化

2. **同音字学习优化**（3-5 天）
   - 改进差异检测算法
   - 添加验证机制

### 阶段 2：功能增强（根据实际需求）

1. **Glossary/专名/数字保护**（1 周）
   - 如果 NMT Repair 误修改了专名或数字
   - 优先级：中

2. **Partial Results 处理**（1-2 周）
   - 如果需要更快的响应（< 500ms）
   - 优先级：低

3. **A/B 调参框架**（1-2 周）
   - 如果需要自动化调参
   - 优先级：低

4. **失败模式用例集**（3-5 天）
   - 逐步积累
   - 优先级：低

---

## 关键决策点

### 是否需要性能优化？

**判断标准**：
- 如果当前延迟已满足需求 → 不需要
- 如果延迟影响用户体验 → 需要优化

**建议**：先观察实际使用情况，根据用户反馈决定

### 是否需要 Glossary 保护？

**判断标准**：
- 如果 NMT Repair 没有误修改专名或数字 → 不需要
- 如果出现了误修改 → 需要实现

**建议**：先观察实际使用情况，根据错误报告决定

### 是否需要 Partial Results 处理？

**判断标准**：
- 如果 final 结果的处理速度已满足需求 → 不需要
- 如果需要更快的响应（< 500ms）→ 考虑实现

**建议**：先观察实际使用情况，根据延迟需求决定

---

## 总结

### 当前状态

✅ **P0 核心功能已完成**（100%）  
✅ **P0 优化已完成**（100%）  
✅ **NMT Repair 已完成**（同音字检测、修复、自动学习）  
⏸️ **其他功能待定**（根据实际需求决定）

### 下一步行动

1. **观察实际使用情况**（1-2 周）
   - 收集用户反馈
   - 分析性能数据
   - 识别问题场景

2. **根据反馈决定优化方向**
   - 如果延迟影响用户体验 → 性能优化
   - 如果出现误修改 → Glossary 保护
   - 如果需要更快响应 → Partial Results 处理

3. **长期规划**：根据实际使用效果决定后续功能

---

## 相关文档

- `AGGREGATOR_OPTIMIZATION_AND_REMAINING_WORK.md` - 优化与剩余工作
- `AGGREGATOR_NMT_REPAIR_IMPLEMENTATION.md` - NMT Repair 实现文档
- `AGGREGATOR_IMPLEMENTATION_STATUS_AND_ARCHITECTURE.md` - 实现状态与架构

