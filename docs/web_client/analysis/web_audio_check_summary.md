# Web端音频传输检查总结

## 调度服务器发送的音频（共9段）

根据调度服务器日志分析，以下音频已从调度服务器发送到web端：

| # | utterance_index | tts_audio_len | 文本内容 |
|---|------------------|--------------|----------|
| 1 | 0 | 124,988 | "再让我们来试一下这个版本的测试器" |
| 2 | 4 | 138,640 | "现在我们已经修正了这个播放的逻辑" |
| 3 | 2 | 103,824 | "大家可以看到一些了" |
| 4 | 8 | 96,316 | "我们现在说等一下这个返回结果" |
| 5 | 11 | 382,352 | "有些云好像被丢弃了 暂时不知道为什么 明明这个时间有累架 但是没有出现" |
| 6 | 13 | 305,212 | "结结果没有回来 可能需要再等一会儿 但我始终是在播放我说的前一句话" |
| 7 | 17 | 111,336 | "再等一会儿 可能需要" |
| 8 | 19 | 656,784 | "那行吧 理论上是可以理解对方在说什么的虽然这个翻译的效果不是特别好可能我们回头还..." |
| 9 | 28 | 329,104 | "有一段硬瓶进来 但是没有显示在播放区域我不知道这个硬瓶是不是被丢起了" |

## 如何检查Web端日志

### 方法1：在浏览器控制台中检查

1. 打开浏览器开发者工具（按 `F12`）
2. 切换到 **Console** 标签
3. 在控制台中搜索以下关键词：

#### 关键日志模式：

**✅ 收到翻译结果：**
```
[App] 📥 收到 translation_result 消息
```
应该看到9条这样的日志，每条对应一个utterance_index

**✅ 准备添加音频：**
```
[App] 🎵 准备添加 TTS 音频到缓冲区
```
应该看到9条这样的日志

**✅ 音频已添加到缓冲区：**
```
TtsPlayer: ✅ 音频块已添加到缓冲区
```
应该看到9条这样的日志，包含 `utterance_index` 和 `buffer_count`

**❌ 音频被丢弃（如果出现）：**
```
[App] ⚠️ 会话已结束，丢弃...
```
或
```
[App] ⚠️ 收到空文本结果（静音检测），跳过缓存和播放
```

### 方法2：导出控制台日志进行分析

1. 在浏览器控制台中，右键点击
2. 选择 "Save as..." 或复制所有日志
3. 保存为文件（例如 `web_console.log`）
4. 运行分析脚本：
   ```bash
   python analyze_web_audio_logs.py web_console.log
   ```

### 方法3：手动检查关键日志

在浏览器控制台中，按 `Ctrl+F` 搜索以下内容，检查每个utterance_index：

1. 搜索 `utterance_index=0` - 应该看到：
   - `[App] 📥 收到 translation_result 消息` (包含 utterance_index: 0)
   - `[App] 🎵 准备添加 TTS 音频到缓冲区` (包含 utterance_index: 0)
   - `TtsPlayer: ✅ 音频块已添加到缓冲区` (包含 utterance_index: 0)

2. 对每个utterance_index (0, 2, 4, 8, 11, 13, 17, 19, 28) 重复上述检查

## 预期结果

如果所有音频都正确传输到web端，应该看到：
- ✅ 9条 `收到 translation_result 消息` 日志
- ✅ 9条 `准备添加 TTS 音频到缓冲区` 日志
- ✅ 9条 `音频块已添加到缓冲区` 日志
- ❌ 0条 `丢弃` 或 `跳过` 日志（除非是空结果）

## 如果发现问题

如果某些音频没有出现在缓冲区中，可能的原因：
1. **会话已结束** - 检查是否有 `会话已结束，丢弃` 日志
2. **空结果被跳过** - 检查是否有 `收到空文本结果（静音检测），跳过缓存和播放` 日志
3. **WebSocket连接问题** - 检查是否有连接错误日志
4. **解码错误** - 检查是否有 `添加音频块时出错` 日志

