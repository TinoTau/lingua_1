# å¤‡ä»½ä»£ç ç™½å±æ ¹æœ¬åŸå› åˆ†æ

**æ—¥æœŸ**: 2026-01-21 03:50  
**é—®é¢˜**: æ‰§è¡Œ npm run build åä»ç„¶ç™½å±  
**çŠ¶æ€**: âœ… **å·²æ‰¾åˆ°æ ¹æœ¬åŸå› **

---

## ğŸ” æ·±å…¥åˆ†æ

### å‘ç°çš„å…³é”®ä¿¡æ¯

#### 1. Buildå·²æˆåŠŸ

âœ… **renderer/dist ç›®å½•å­˜åœ¨å¹¶æœ‰å†…å®¹**:
```
D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node\renderer\dist\
  - assets/
    - index-C84F1Ju_.js
    - index-D41K5n2Q.css
  - index.html
```

---

#### 2. ä½†æ—¥å¿—æ˜¾ç¤ºè¿˜åœ¨å°è¯•è¿æ¥Vite

```json
{
  "error": {"code":"ERR_CONNECTION_REFUSED","url":"http://localhost:5173/"},
  "msg":"Failed to load Vite dev server, trying fallback port"
}
```

**è¯´æ˜**: ä»£ç èµ°äº†"å¼€å‘æ¨¡å¼"åˆ†æ”¯ï¼Œè€Œä¸æ˜¯"ç”Ÿäº§æ¨¡å¼"åˆ†æ”¯

---

#### 3. è·¯å¾„è®¡ç®—é—®é¢˜

**window-manager.ts ä¸­çš„é€»è¾‘**:
```typescript
const distPath = path.join(__dirname, '../../renderer/dist/index.html');
const distExists = fs.existsSync(distPath);

if (isDev && !distExists) {
  // åŠ è½½ Vite
} else {
  // åŠ è½½æ„å»ºæ–‡ä»¶
}
```

**é—®é¢˜**:
- `__dirname` åœ¨ç¼–è¯‘åæŒ‡å‘ `main/electron-node/main/src`
- `../../renderer/dist/index.html` = `main/electron-node/renderer/dist/index.html` âŒ
- ä½†å®é™…è·¯å¾„æ˜¯ `renderer/dist/index.html` âœ…
- è·¯å¾„è®¡ç®—é”™è¯¯ â†’ `distExists` = false
- å¯¼è‡´è¿›å…¥å¼€å‘æ¨¡å¼åˆ†æ”¯

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®å¤è·¯å¾„è®¡ç®—ï¼ˆæ¨èï¼‰

**ä¿®æ”¹ `window-manager.ts`**:

å°†ï¼š
```typescript
const distPath = path.join(__dirname, '../../renderer/dist/index.html');
```

æ”¹ä¸ºï¼š
```typescript
const distPath = path.join(__dirname, '../../../../renderer/dist/index.html');
```

**åŸå› **:
- ç¼–è¯‘å `__dirname` = `main/electron-node/main/src`
- `../../../../` = å›åˆ°é¡¹ç›®æ ¹ç›®å½•
- ç„¶åè¿›å…¥ `renderer/dist/index.html`

---

### æ–¹æ¡ˆ2: ä½¿ç”¨ç»å¯¹è·¯å¾„

```typescript
const projectRoot = path.resolve(__dirname, '../../../../');
const distPath = path.join(projectRoot, 'renderer/dist/index.html');
```

---

### æ–¹æ¡ˆ3: ä½¿ç”¨ app.getAppPath()

```typescript
const distPath = path.join(app.getAppPath(), 'renderer/dist/index.html');
```

---

## ğŸ› ï¸ ç«‹å³ä¿®å¤

### å¿«é€Ÿä¿®å¤ä»£ç 

**æ–‡ä»¶**: `D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node\main\src\window-manager.ts`

**ä¿®æ”¹ç¬¬30è¡Œ**:
```typescript
// ä¿®æ”¹å‰
const distPath = path.join(__dirname, '../../renderer/dist/index.html');

// ä¿®æ”¹å
const distPath = path.join(__dirname, '../../../../renderer/dist/index.html');
```

---

### ç„¶åé‡æ–°ç¼–è¯‘å¹¶å¯åŠ¨

```powershell
cd D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node

# é‡æ–°ç¼–è¯‘mainè¿›ç¨‹
npm run build:main

# å¯åŠ¨
npm start
```

---

## ğŸ“‹ éªŒè¯è·¯å¾„

### PowerShellè„šæœ¬éªŒè¯

```powershell
# æ£€æŸ¥ç¼–è¯‘åçš„å®é™…è·¯å¾„
$mainIndexPath = "D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node\main\electron-node\main\src"
Write-Host "__dirname ä½ç½®: $mainIndexPath"

# æµ‹è¯•æ—§è·¯å¾„ï¼ˆé”™è¯¯ï¼‰
$oldPath = Join-Path $mainIndexPath "..\..\renderer\dist\index.html"
$oldPathResolved = [System.IO.Path]::GetFullPath($oldPath)
Write-Host ""
Write-Host "æ—§è·¯å¾„ (../../): $oldPathResolved"
Write-Host "å­˜åœ¨? $(Test-Path $oldPathResolved)"

# æµ‹è¯•æ–°è·¯å¾„ï¼ˆæ­£ç¡®ï¼‰
$newPath = Join-Path $mainIndexPath "..\..\..\..\..\renderer\dist\index.html"
$newPathResolved = [System.IO.Path]::GetFullPath($newPath)
Write-Host ""
Write-Host "æ–°è·¯å¾„ (../../../../): $newPathResolved"
Write-Host "å­˜åœ¨? $(Test-Path $newPathResolved)"
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

### è·¯å¾„ç»“æ„è¯´æ˜

**é¡¹ç›®ç»“æ„**:
```
electron-node/
â”œâ”€â”€ main/
â”‚   â””â”€â”€ electron-node/
â”‚       â””â”€â”€ main/
â”‚           â””â”€â”€ src/              â† __dirname åœ¨è¿™é‡Œ
â”‚               â””â”€â”€ window-manager.js
â”œâ”€â”€ renderer/
â”‚   â””â”€â”€ dist/
â”‚       â””â”€â”€ index.html            â† ç›®æ ‡æ–‡ä»¶
â””â”€â”€ package.json
```

**è·¯å¾„è®¡ç®—**:
```
__dirname:           main/electron-node/main/src
../../:              main/electron-node/         âŒ è¿˜åœ¨ main ç›®å½•å†…
../../../../:        ./                          âœ… å›åˆ°é¡¹ç›®æ ¹ç›®å½•
../../../../renderer/dist/index.html             âœ… æ­£ç¡®è·¯å¾„
```

---

## âš ï¸ å…¶ä»–å¯èƒ½çš„é—®é¢˜

### å¦‚æœä¿®å¤åè¿˜æ˜¯ç™½å±

#### æ£€æŸ¥1: æ„å»ºæ–‡ä»¶æ˜¯å¦å®Œæ•´

```powershell
Get-ChildItem "D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node\renderer\dist"
```

åº”è¯¥çœ‹åˆ°ï¼š
- index.html
- assets/ (å†…å« .js å’Œ .css æ–‡ä»¶)

---

#### æ£€æŸ¥2: index.htmlå†…å®¹

```powershell
Get-Content "D:\Programs\github\lingua_1\expired\lingua_1-main\electron_node\electron-node\renderer\dist\index.html" | Select-Object -First 20
```

åº”è¯¥åŒ…å«å¯¹ assets ä¸­æ–‡ä»¶çš„å¼•ç”¨

---

#### æ£€æŸ¥3: Electronå¼€å‘è€…å·¥å…·

**åœ¨Electronçª—å£ä¸­æŒ‰ `Ctrl+Shift+I` æ‰“å¼€å¼€å‘è€…å·¥å…·**

æŸ¥çœ‹Consoleæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

---

## ğŸ“Š è¯Šæ–­æµç¨‹æ€»ç»“

| æ­¥éª¤ | æ£€æŸ¥é¡¹ | ç»“æœ |
|------|--------|------|
| 1 | renderer/dist æ˜¯å¦å­˜åœ¨ | âœ… å­˜åœ¨ |
| 2 | æ„å»ºæ–‡ä»¶æ˜¯å¦å®Œæ•´ | âœ… å®Œæ•´ |
| 3 | æ—¥å¿—æ˜¾ç¤ºå°è¯•è¿æ¥Vite | âŒ ä¸åº”è¯¥ |
| 4 | è·¯å¾„è®¡ç®— `__dirname + ../../` | âŒ é”™è¯¯ |
| **æ ¹æœ¬åŸå› ** | **ç›¸å¯¹è·¯å¾„å±‚çº§ä¸è¶³** | **éœ€è¦ ../../../../** |

---

## âœ… ä¿®å¤æ€»ç»“

### é—®é¢˜
- ç›¸å¯¹è·¯å¾„ `../../` æ— æ³•ä» `main/electron-node/main/src` åˆ°è¾¾ `renderer/dist`
- `distExists` æ£€æŸ¥å¤±è´¥
- é”™è¯¯åœ°è¿›å…¥å¼€å‘æ¨¡å¼åˆ†æ”¯
- å°è¯•è¿æ¥ä¸å­˜åœ¨çš„ Vite æœåŠ¡å™¨
- ç»“æœç™½å±

### è§£å†³
1. ä¿®æ”¹ window-manager.ts ç¬¬30è¡Œ
2. ä½¿ç”¨ `../../../../` ä»£æ›¿ `../../`
3. é‡æ–°ç¼–è¯‘ main è¿›ç¨‹
4. é‡å¯èŠ‚ç‚¹ç«¯

### é¢„æœŸç»“æœ
- âœ… æ­£ç¡®åŠ è½½ renderer/dist/index.html
- âœ… Electronçª—å£æ˜¾ç¤ºèŠ‚ç‚¹ç«¯ç•Œé¢
- âœ… ä¸å†ç™½å±

---

**å…³é”®**: TypeScriptç¼–è¯‘åçš„è·¯å¾„å±‚çº§ä¸æºä»£ç ä¸åŒï¼Œéœ€è¦æ ¹æ®ç¼–è¯‘åçš„å®é™…ç»“æ„è°ƒæ•´ç›¸å¯¹è·¯å¾„ï¼
