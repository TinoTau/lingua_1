# 自动语种识别模型选型与实施计划

本文档是 [自动语种识别与双向模式设计](./AUTO_LANGUAGE_DETECTION_AND_TWO_WAY_MODE.md) 的子文档，包含模型选型建议、实施计划和风险评估。

**返回**: [自动语种识别主文档](./AUTO_LANGUAGE_DETECTION_AND_TWO_WAY_MODE.md)

---

## 8. 模型选型建议

### 8.1 大语种检测（zh/en/ja/ko）

**推荐方案**：使用 Whisper 的语言检测能力

- ✅ 准确率高（>95%）
- ✅ 无需额外模型
- ✅ 延迟低（复用 ASR 结果）
- ✅ 支持方言

**备选方案**：使用独立的语言检测模型

- ⚠️ 需要额外的模型文件
- ⚠️ 增加推理延迟
- ✅ 可以更精确控制检测范围

### 8.2 ASR 模型

**推荐**：Whisper（已使用）

- ✅ 支持多语言
- ✅ 支持方言
- ✅ 内置语言检测能力

### 8.3 TTS 模型

**推荐**：Piper（已使用）

- ✅ 支持多语言
- ✅ 输出质量高
- ✅ 延迟低

---

## 9. 整体流程图

### 9.1 自动大语种识别流程

```
用户说话
  ↓
ASR (Whisper)
  ↓
LanguageDetector 检测语言
  ↓
判断翻译方向（Two-way Auto Mode）
  ↓
NMT 翻译
  ↓
TTS 合成
  ↓
返回结果
```

---

## 10. 实施计划

### 阶段1：基础语言检测框架（已完成 ✅）

- ✅ 创建 LanguageDetector 模块
- ✅ 定义 LanguageDetectionResult 结果类型
- ✅ 实现基础检测逻辑
- ✅ 单元测试（7个测试，全部通过）

### 阶段2：双向模式框架（已完成 ✅）

- ✅ 消息协议扩展
- ✅ 推理流程修改
- ✅ Web 客户端 UI 支持
- ✅ 单元测试（14个测试，全部通过）

### 阶段3：完善与优化（部分完成）

- ✅ 错误处理和回退机制
- ✅ 性能优化
- ⏸️ 端到端测试（建议在联合调试时进行）

---

## 11. 风险评估

### 11.1 潜在风险

#### ⚠️ 语言检测准确率

**风险**：语言检测可能不准确，导致翻译方向错误

**缓解措施**：
- 使用高准确率的检测方法（Whisper）
- 设置置信度阈值
- 提供回退策略

#### ⚠️ 性能影响

**风险**：语言检测可能增加推理延迟

**缓解措施**：
- 复用 ASR 结果，避免重复推理
- 优化检测算法
- 异步处理（如可能）

#### ⚠️ 节点兼容性

**风险**：部分节点可能不支持语言检测

**缓解措施**：
- 提供回退策略
- 明确节点能力要求
- 在节点注册时检查能力

### 11.2 风险可控

所有风险都有明确的缓解措施，风险可控。

---

## 12. 未来可扩展功能

- 支持更多语言（法语、德语、西班牙语等）
- 支持更细粒度的方言识别
- 支持语言切换检测（检测用户切换语言）
- 支持多语言混合识别

---

## 13. 总结（给开发部门）

### 关键工作点

1. ✅ LanguageDetector 模块实现（已完成）
2. ✅ 消息协议扩展（已完成）
3. ✅ 推理流程修改（已完成）
4. ✅ Web 客户端 UI 支持（已完成）
5. ✅ 单元测试（已完成）

### 完成以上，即可支持

- ✅ 自动大语种识别（zh/en/ja/ko）
- ✅ 双向实时会话
- ✅ 方言处理（统一归类为中文）

---

**返回**: [自动语种识别主文档](./AUTO_LANGUAGE_DETECTION_AND_TWO_WAY_MODE.md) | [设计概述](./AUTO_LANGUAGE_DETECTION_OVERVIEW.md) | [实现设计详情](./AUTO_LANGUAGE_DETECTION_IMPLEMENTATION.md)

