# Web 端实时语音翻译 —— 功能需求说明（FRD）

版本：v1.0  
作者：Tino（产品规划）  

---

## 1. 概述

本功能为 Web 页面上的“实时语音翻译”模块，采用半双工交互模式，解决用户语音输入与 TTS 外放之间的冲突问题，并提供稳定、易理解的交互体验。

---

## 2. 角色与环境

- 使用终端：支持现代浏览器的 PC / 平板 / 手机。  
- 典型用户：普通用户、老年用户、轻度数字用户。  
- 网络环境：4G / 5G / Wi-Fi（中等网络延迟）。  

---

## 3. 功能列表

| 编号   | 功能名称               | 功能描述                                                   | 优先级 |
|--------|------------------------|------------------------------------------------------------|--------|
| FR-01  | 半双工交互模式         | 输入与输出不能同时进行，输入模式采集语音，输出模式仅播放 | 高     |
| FR-02  | 输出模式自动关麦       | 在 WAITING_RESULT 和 PLAYING_TTS 状态下关闭麦克风        | 高     |
| FR-03  | Send 按钮结束发言      | 用户可手动结束当前发言并触发翻译流程                     | 高     |
| FR-04  | 静音自动结束当前发言   | 在静音超过阈值时自动结束本轮发言                         | 高     |
| FR-05  | 播放期间语音丢弃       | 播放 TTS 期间不采集、不上传用户语音                      | 高     |
| FR-06  | 实时识别字幕展示       | 输入模式下实时展示 ASR 字幕                               | 中     |
| FR-07  | 译文字幕展示           | 输出模式下展示翻译文本字幕                               | 中     |
| FR-08  | 上下文拼接（话语组）   | 同一话题下的多轮发言作为一个语义组处理                   | 中     |
| FR-09  | 多语言支持             | 支持至少两种语言方向（如中→英、英→中）                   | 中     |
| FR-10  | 错误提示与重试         | 网络异常、超时等情况下给出清晰提示并支持重试             | 高     |

---

## 4. 详细需求描述

### 4.1 半双工交互（FR-01，FR-02）

**需求：**

- 在输入模式下：
  - 麦克风开启，可采集音频；  
  - 不播放 TTS。  
- 在输出模式下：
  - 播放 TTS；  
  - 麦克风必须关闭，不采集任何音频。  

**验收：**

- 输出模式期间，浏览器不会请求或持有任何 active 音频输入流。  

---

### 4.2 Send 按钮（FR-03）

**需求：**

- UI 提供一个明显的按钮（“Send / 结束本轮”）。  
- 在 INPUT_RECORDING 状态下可点击。  
- 点击后必须立即：
  - 停止录音；  
  - 通知服务端当前音频结束；  
  - 进入 WAITING_RESULT 状态。  

**验收：**

- 点击 Send 后，录音图标应立即切换为“非录音状态”，不再继续上传音频。  

---

### 4.3 静音自动结束（FR-04）

**需求：**

- 系统在 INPUT_RECORDING 状态下监控音量。  
- 当连续静音时间 > 静音阈值（例如 1 秒）时，自动结束当前发言，效果等同于用户点击 Send。  

**验收：**

- 用户停顿不说话后，系统在 1 秒左右自动结束本轮并进入等待翻译状态。  

---

### 4.4 播放期间语音丢弃（FR-05）

**需求：**

- 在 WAITING_RESULT 与 PLAYING_TTS 状态下，系统不得采集任何音频。  
- 即使用户在此期间说话，也不会被系统接收或上传。  

**验收：**

- 前端不再持有 active 麦克风流；  
- 后端在这两个状态不会收到新的音频帧。  

---

### 4.5 实时识别字幕展示（FR-06）

**需求：**

- 在 INPUT_RECORDING 状态中，页面应展示实时 ASR 文本。  
- ASR 可每隔一定时间增量更新识别结果。  

**验收：**

- 用户说话时，界面上应出现动态更新的原文字幕。  

---

### 4.6 译文字幕展示（FR-07）

**需求：**

- 在 PLAYING_TTS 状态中，展示对应语言的译文文本。  
- 字幕可与音频同步或整体展示。  

**验收：**

- 播放 TTS 时，界面上有对应的译文文本区域。  

---

### 4.7 上下文拼接（FR-08）

**需求：**

- 后端维护 Group 概念，将同一话题下的多轮发言归入同一 Group。  
- 翻译时允许引擎参考 Group 内历史文本，以得到更连贯的翻译。  

**验收：**

- 在连续多轮补充同一话题时，译文整体语义连贯，无明显断裂。  

---

## 5. 用户界面（UI）草图（文本版）

### 5.1 输入模式 UI

```text
 -----------------------------------------------------
|                 实时语音翻译（Web）                 |
 -----------------------------------------------------
|  [● 麦克风图标 - 红色]   状态：正在收音（请开始说话） |
|                                                     |
|  原文字幕（ASR）：                                   |
|  -------------------------------------------------- |
|  我想咨询一下明天的天气……                           |
|  -------------------------------------------------- |
|                                                     |
|  [ Send / 结束本轮 ]   （按钮，高亮）                |
|                                                     |
 -----------------------------------------------------
```

### 5.2 输出模式 UI

```text
 -----------------------------------------------------
|                 实时语音翻译（Web）                 |
 -----------------------------------------------------
|  [○ 麦克风图标 - 灰色]   状态：对方在说话，请稍候…   |
|                                                     |
|  译文字幕（TTS）：                                   |
|  -------------------------------------------------- |
|  I would like to ask about the weather tomorrow.    |
|  -------------------------------------------------- |
|                                                     |
|  [ Send / 结束本轮 ]   （按钮禁用或隐藏）            |
|                                                     |
 -----------------------------------------------------
```

---

## 6. 非功能性需求（节选）

- 响应时间：在网络条件良好时，从结束发言到开始播放 TTS 的时间建议控制在 1–3 秒。  
- 兼容性：支持 Chrome / Edge / Safari 最新版本。  
- 隐私：语音数据仅用于实时翻译，不做长期存储，或遵从后端隐私策略。  

---

## 7. 版本与后续扩展

- v1.0：完成半双工、基本流式翻译与字幕展示。  
- 后续可以扩展：
  - 多说话人标记；  
  - 情绪识别；  
  - 可视化音量条；  
  - 多种 TTS 音色/语速配置。  
