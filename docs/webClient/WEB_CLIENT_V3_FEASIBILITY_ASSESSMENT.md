# Web 客户端 v3 统一设计方案可行性评估

版本：v1.0  
评估日期：2025-12-12

## 1. 方案概述

v3 统一设计方案的核心特点：

1. **半双工模式**：输入模式和输出模式自动切换
2. **ASR 字幕（强制）**：实时显示识别内容
3. **Utterance Group（最高优先级）**：上下文拼接机制
4. **Send 按钮主导节奏**：用户主动结束发言
5. **静音自动结束**：固定参数（1000ms + 250ms 尾部缓冲）

## 2. 可行性评估

### 2.1 核心功能可行性 ✅

| 功能 | 当前支持 | 需要扩展 | 可行性 |
|------|---------|---------|--------|
| 半双工模式 | ✅ 前端可实现 | 无 | ⭐⭐⭐⭐⭐ |
| Send 按钮 | ✅ 已有类似 | 无 | ⭐⭐⭐⭐⭐ |
| 静音自动结束 | ✅ 前端可实现 | 无 | ⭐⭐⭐⭐⭐ |
| ASR 字幕（partial） | ⚠️ 需扩展 | 后端支持流式 ASR | ⭐⭐⭐⭐ |
| Utterance Group | ⚠️ 需扩展 | 后端支持 Group 管理 | ⭐⭐⭐⭐ |
| 流式 TTS | ✅ 已支持 | 无 | ⭐⭐⭐⭐⭐ |

### 2.2 需要扩展的功能

#### ⚠️ 1. 流式 ASR Partial 结果

**需求**：
- ASR 引擎必须支持增量输出（partial + final）
- 后端需要推送 `asr_partial` 消息
- 前端需要实时显示 ASR 字幕

**当前状态**：
- ✅ Whisper 支持流式识别（whisper-rs 库支持）
- ⚠️ 节点推理服务需要扩展以支持 partial 结果推送
- ⚠️ 调度服务器需要支持转发 partial 结果
- ⚠️ WebSocket 协议需要扩展 `asr_partial` 消息类型

**实施难度**：⭐⭐⭐ 中等

#### ⚠️ 2. Utterance Group 管理

**需求**：
- 后端维护 Group 概念
- 支持 Group 创建和归属判断
- 翻译时使用上下文（Group 内所有 part）

**当前状态**：
- ⚠️ 调度服务器需要扩展 Session 管理以支持 Group
- ⚠️ 节点推理服务需要支持上下文拼接
- ⚠️ NMT 引擎需要支持上下文输入

**实施难度**：⭐⭐⭐⭐ 较高

## 3. 实施建议

### 3.1 分阶段实施

#### 阶段 2.1：核心功能（1-2周）
- ✅ 半双工状态机
- ✅ Send 按钮
- ✅ 静音自动结束
- ✅ 播放期间关麦
- ✅ 基础 WebSocket 通信

#### 阶段 2.1.2：ASR 字幕（1周）
- ⚠️ 扩展节点推理服务支持 partial 结果
- ⚠️ 扩展调度服务器转发 partial 结果
- ⚠️ 扩展 WebSocket 协议
- ⚠️ 前端实现实时字幕显示

#### 阶段 2.1.3：Utterance Group（1-2周）
- ⚠️ 扩展调度服务器支持 Group 管理
- ⚠️ 扩展节点推理服务支持上下文拼接
- ⚠️ 扩展 NMT 引擎支持上下文输入

### 3.2 推荐实施顺序

**v1 最小可行版本**：
1. 半双工状态机
2. Send 按钮
3. 静音自动结束
4. 播放期间关麦
5. 基础翻译流程

**v1.1 增强版本**：
6. ASR 字幕（partial 结果）

**v1.2 完整版本**：
7. Utterance Group 上下文拼接

## 4. 结论

**总体可行性**：⭐⭐⭐⭐ **高度可行**

**建议**：
- ✅ 立即开始实施阶段 2.1（核心功能）
- ⚠️ 阶段 2.1.2 和 2.1.3 可以并行开发，但需要后端支持
- ✅ 先实现最小可行版本，再逐步增强

