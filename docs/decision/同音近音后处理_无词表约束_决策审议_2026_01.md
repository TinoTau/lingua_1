# 同音/近音后处理：无词表约束与可行方案 — 决策审议

## 1. 约束（产品与部署）

- **节点由用户自行下载部署**，调度服务器**随机分配任务**，同一节点会处理来自不同会话、不同用户的任务。
- 因此：**节点上的词表无法覆盖所有任务**；在节点侧积累「常用词」「错误→正确映射」等词表**没有意义**，且增加维护成本。
- **决策**：节点端**不采用任何词表设计**（包括常用词表、错误→正确短语表、可学习词表等）。

## 2. 同音/近音后处理在无词表下的局限

- **目标**：在 ASR 输出上做「同音/近音」纠错，只允许同音字替换，避免跨音误改（如 余英→英文）。
- **必要环节**：  
  - 用「同音字组」（由拼音数据自动得到，非词表）约束**可替换候选**；  
  - 在多个同音候选（如 余/语/鱼）中**选出一个**，必须依赖某种**偏好或打分**。
- **无词表时的后果**：  
  - 若**不用词表**，且**不用其他打分手段**（如语言模型），则无法在 余/语/鱼 中选 语；  
  - 多候选时只能**保留原字**，即**不进行替换**，同音/近音后处理**无法产生实际纠错效果**。

## 3. 当前实现状态

- **已实现**：  
  - Pipeline 中已增加 **PHONETIC_CORRECTION** 步骤（位于 AGGREGATION 与 SEMANTIC_REPAIR 之间）；  
  - 模块内保留**同音字组**（SAME_PINYIN_GROUPS），由拼音自动得到 字→[同音字]，**无词表**；  
  - 在满足「无词表」约束下，多候选时**一律保留原字**，故 **correct(text) 当前恒返回原文**，本步不修改文本。
- **效果**：  
  - 当前该步骤**不产生实际纠错**，仅保留流水线占位与同音字组数据结构，便于日后接入**非词表打分**（如 LM 文件）时复用。

## 4. 可选方向（供决策部门审议）

| 选项 | 内容 | 说明 |
|------|------|------|
| **A. 维持现状** | 保留 PHONETIC_CORRECTION 步骤与同音字组，不做替换，满足「无词表」约束。 | 无纠错效果，仅占位；后续若引入 LM 等非词表打分，可在此扩展。 |
| **B. 移除步骤** | 从 Pipeline 中移除 PHONETIC_CORRECTION，不再保留同音/近音后处理占位。 | 代码更简；若将来要做同音纠错，需重新加步骤与数据结构。 |
| **C. 引入非词表打分** | 在满足「无词表」前提下，引入**一次性数据/模型**（如 n-gram 语言模型文件、小规模神经 LM）对候选句打分，在同音字组内选最优。 | 可产生实际纠错效果；需选型、数据/模型来源与部署方式（随节点分发或单独下载），由决策部门拍板。 |

## 5. 小结

- **约束**：节点端不采用任何词表（用户自部署 + 随机调度，词表无法应对所有任务，积累无意义）。
- **结论**：在该约束下，若不引入**非词表打分**（如 LM），同音/近音后处理**无法在多候选时选优**，当前实现**不修改文本**，仅占位。
- **提请审议**：采纳上述 A/B/C 中哪一选项，或是否另行规定「非词表打分」的边界与实现路径。
