# ASR 识别准确度优化

## 问题描述

用户反馈识别结果存在严重的同音字错误，两个字的词被识别为一个发音相似的字，导致语义不正确。

## 优化方案

### 1. 增加 beam_size（从 5 增加到 10）

**原因**：beam_size 越大，模型会探索更多的候选路径，减少同音字错误。

**影响**：
- ✅ 提高识别准确度
- ⚠️ 增加处理时间（约 20-30%）

### 2. 添加 temperature 参数（设置为 0.0）

**原因**：temperature=0.0 使模型输出更确定，减少随机性，提高准确度。

**默认值**：0.0（最确定）

### 3. 添加 patience 参数（设置为 1.0）

**原因**：patience 控制 beam search 的耐心值，1.0 是默认值，可以稍微增加以提高准确度。

**默认值**：1.0

### 4. 添加 compression_ratio_threshold 参数（设置为 2.4）

**原因**：过滤压缩比异常的结果，避免模型输出重复或异常文本。

**默认值**：2.4

### 5. 添加 log_prob_threshold 参数（设置为 -1.0）

**原因**：过滤低概率的结果，只保留高置信度的识别结果。

**默认值**：-1.0

### 6. 添加 no_speech_threshold 参数（设置为 0.6）

**原因**：过滤无语音段，避免将噪音识别为文本。

**默认值**：0.6

## 修改的文件

1. **`faster_whisper_vad_service.py`**
   - 更新 `UtteranceRequest` 类，添加新参数
   - 更新 `beam_size` 默认值从 5 改为 10
   - 更新 `submit_task` 调用，传递新参数

2. **`asr_worker_manager.py`**
   - 更新 `ASRTask` 数据类，添加新参数
   - 更新 `submit_task` 方法签名，添加新参数

3. **`asr_worker_process.py`**
   - 更新 `transcribe` 调用，使用新参数

## 参数说明

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `beam_size` | int | 10 | Beam search 宽度（从 5 增加到 10） |
| `temperature` | float | 0.0 | 采样温度（0.0 更确定） |
| `patience` | float | 1.0 | Beam search 耐心值 |
| `compression_ratio_threshold` | float | 2.4 | 压缩比阈值（过滤异常结果） |
| `log_prob_threshold` | float | -1.0 | 对数概率阈值（过滤低概率结果） |
| `no_speech_threshold` | float | 0.6 | 无语音阈值（过滤无语音段） |

## 预期效果

1. **减少同音字错误**：beam_size 增加会探索更多候选路径
2. **提高识别准确度**：temperature=0.0 使输出更确定
3. **过滤低质量结果**：通过阈值参数过滤异常结果

## 性能影响

- **处理时间**：预计增加 20-30%（由于 beam_size 增加）
- **准确度**：预计提高 10-20%（减少同音字错误）

## 下一步

1. 测试优化后的识别准确度
2. 如果准确度仍不够，可以进一步增加 beam_size（如 15 或 20）
3. 如果处理时间过长，可以适当降低 beam_size（如 8）

## 注意事项

- 这些参数都是可选的，如果客户端不传递，会使用默认值
- beam_size 增加会显著增加处理时间，需要权衡准确度和性能
- 如果识别准确度仍不够，可能需要考虑：
  - 使用更大的模型（如 large-v3-turbo）
  - 对模型进行微调
  - 添加后处理纠错模块

