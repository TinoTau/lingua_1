
# 多语言轮流交流场景下的 ASR 准确率提升技术方案
## 适用场景：线下双人轮流表达 / 线上会议室（多语输入 → 单一输出）

---

## 0. 文档目标与约束

### 0.1 目标
- 在**不能固定语言**的前提下，提高节点端 ASR 文本准确率
- 在**保证翻译效率**的前提下，避免大规模重跑
- 正确处理**大量停顿**与**用户手动截断**带来的边界问题
- 可直接交付开发部门实施

### 0.2 已知约束
- 不同 utterance 语言可能频繁切换
- 用户在听完翻译/TTS 前通常不会说话（停顿较多）
- 用户可能在尚未完全说完时手动触发截断
- ASR 返回包含：
  - `language`
  - `language_probability`
  - `language_probabilities[]`

---

## 1. 场景特性分析

### 1.1 线下双人轮流交流
- 双方轮流完整表达观点
- 句间停顿明显（等待翻译播报）
- 偶尔使用“手动截断”加快交流节奏
- 语言不可固定，甚至可能一句一换

### 1.2 线上会议室模式
- 多人、多语输入
- 输出语言固定（如统一翻译成英文）
- 需要在保证吞吐的同时避免错误语言路由

---

## 2. 总体策略概览

采用 **“稳定边界 + 语言置信驱动 + 触发式补救”** 的组合策略：

1. **边界稳态化（P0）**
2. **语言独立识别 + 置信度分级（P0）**
3. **默认关闭上下文提示，避免跨语言污染（P0）**
4. **仅在坏段触发重跑（P1）**
5. **与跨 utterance 去重/合并模块联动（P1）**

---

## 3. 边界稳态化设计（P0，收益最大）

### 3.1 Hangover（延迟 finalize）

| 触发方式 | Hangover |
|--------|----------|
| 自动静音 finalize | 120–180 ms |
| 手动截断 finalize | 180–220 ms |

作用：避免尾音被截断，减少漏字与错词。

### 3.2 Padding（尾部补静音）

- finalize 后，在 PCM16 音频末尾补 200–300 ms 的 0
- 不要求额外等待，只增加送入 ASR 的音频长度
- 显著提升句尾 token 稳定性

### 3.3 Lookback Overlap（可选）

- 下一段开头拼接上一段尾部 80–120 ms 音频
- 需配合文本去重模块使用
- 优先保证“信息不丢失”，重复由文本层解决

---

## 4. 语言策略设计（不可固定语言场景）

### 4.1 每段独立语言识别
- 所有 utterance 默认：`language = None`
- 完全依赖 ASR 自动识别

### 4.2 语言置信度分级

| 等级 | 条件 | 行为 |
|----|----|----|
| 高置信 | p ≥ 0.90 | 直接采用 |
| 中置信 | 0.70 ≤ p < 0.90 | 采用，但记录 top-2 候选 |
| 低置信 | p < 0.70 | 禁用上下文，允许触发补救 |

### 4.3 短期候选集（非固定 prior）
- 维护最近 6–10 段的 top-2 语言分布
- 仅用于：
  - 坏段触发式重跑
  - 会议室模式下的翻译路由优化

---

## 5. 上下文提示（Prompt）策略

### 5.1 默认策略
- `condition_on_previous_text = false`
- `use_text_context = false`

### 5.2 仅在以下条件全部满足时才允许启用（可选）
- 最近多段语言一致
- `language_probability ≥ 0.90`
- 无重复/乱码风险
- prompt 文本长度 ≤ 100 字符

### 5.3 一旦检测到语言不稳定
- 强制关闭所有上下文提示

---

## 6. 触发式补救机制（P1）

### 6.1 坏段判定条件（任意满足）
- `language_probability < 0.70` 且文本过短
- 明显乱码或非法字符比例高
- 与上一段文本高度重叠
- segments 数异常或文本断裂

### 6.2 补救动作（最多一次升级）
1. 从 `language_probabilities` 中取 top-2 语言
2. 对当前音频重跑：
   - 先 `language = top1`
   - 若仍不可信，再 `language = top2`
3. 最大重跑次数：2

---

## 7. 线上会议室模式的额外约束

- 每段仍独立识别语言
- 输出语言固定（如统一翻译成英文）
- 当 `src_lang == target_lang`：
  - 可直通或轻处理（按产品需求）
- 坏段补救阈值应更严格，避免影响整体吞吐

---

## 8. 推荐默认参数组合

### 8.1 默认路径（效率优先）
- `language = None`
- `beam_size = 2–3`
- `best_of = 1`
- `temperature = 0`
- `condition_on_previous_text = false`
- `use_text_context = false`

### 8.2 边界参数
- 自动 finalize：Hangover 150ms，Padding 220ms
- 手动截断：Hangover 200ms，Padding 280ms
- 短片段合并阈值：400ms

---

## 9. 实施步骤（开发执行顺序）

1. 实现 Hangover / Padding / 短片段合并（P0）
2. 默认关闭上下文 prompt（P0）
3. 接入语言置信度分级逻辑（P0）
4. 实现触发式补救（P1）
5. 与跨 utterance 去重/合并模块联动（P1）

---

## 10. 验收标准

- 句尾漏字明显减少
- 重复三连显著下降
- 多语言切换场景下语言误判率下降
- 整体 ASR 吞吐无明显下降
- 手动截断不再导致严重不完整识别

---

## 11. 结论

在“语言不可固定 + 停顿多 + 手动截断”的真实交流场景下，
**稳定边界与置信度驱动策略**比盲目增加模型复杂度更有效。

该方案以工程稳态为核心，
在保证效率的同时显著提升 ASR 文本准确率，
适合作为当前系统的默认长期方案。
