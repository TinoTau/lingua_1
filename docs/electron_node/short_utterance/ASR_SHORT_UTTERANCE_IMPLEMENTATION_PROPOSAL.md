# ASR 短句识别准确率提升方案 - 决策说明文档

**文档版本**：v1.0  
**日期**：2025-01-XX  
**目标受众**：决策部门  
**状态**：📋 待审批

---

## 执行摘要

### 方案概述

针对当前系统短句识别准确率偏低的问题（特别是同音字、近音词、专名/术语误听），提出**上下文偏置（Contextual Biasing）+ 双通道解码与复核（Rescoring）**技术方案。

**核心思路**：
1. **S1：上下文偏置** - 在 ASR 解码时注入领域词、专名、最近上下文，提升一次性识别命中率
2. **S2：双通道解码 + 复核** - 对短句/低置信文本生成多个候选，通过打分择优选择最优结果

### 关键指标

| 指标 | 当前状态 | 目标 | 预期改善 |
|------|---------|------|---------|
| **短句专名/术语错误率** | 较高 | 下降 20-30% | ✅ 显著改善 |
| **同音字错误率** | 较高 | 下降 30-40% | ✅ 显著改善 |
| **系统延迟（P95）** | 基准 | +50-100ms | ⚠️ 可控 |
| **实施周期** | - | 4-6 周 | ✅ 快速见效 |
| **技术风险** | - | 低 | ✅ 风险可控 |

---

## 1. 问题背景

### 1.1 当前问题

- **短句/短片段**（尤其手动截断、pause_ms 下调）中，ASR 容易出现单词级替换：
  - 同音字错误（如"硬品"→"音频"）
  - 近音词错误（如"命中绿"→"命中率"）
  - 专名/术语误听
- **译文被"一个词"带偏**，语义偏航明显
- **用户反馈**：识别准确率不够，特别是短句场景

### 1.2 业务影响

- **用户体验下降**：频繁出现明显错误，影响使用信心
- **翻译质量下降**：一个词错误导致整句翻译偏航
- **系统可信度降低**：用户对系统准确性产生质疑

---

## 2. 技术方案

### 2.1 方案架构

```
用户语音输入
    ↓
ASR 识别（S1：注入上下文偏置）
    ↓
Aggregator 处理（文本聚合、去重）
    ↓
S2 触发判定（短句/低置信/高风险）
    ↓
候选生成（N-best 或二次解码）
    ↓
Rescorer 打分择优
    ↓
NMT 翻译 / TTS 合成
```

### 2.2 S1：上下文偏置（Contextual Biasing）

**原理**：在 ASR 解码时给模型一个"软提示"，让它更倾向输出领域词、专名、用户最近出现的词。

**实现方式**：
- 通过 `initial_prompt` 注入短语（术语、专名、最近上下文）
- 动态构建 prompt（用户配置 + 最近上下文 + 系统默认词表）
- 长度控制（400-800 字符，可配置）

**优势**：
- ✅ **成本极低**：主要是文本拼接，几乎无 GPU 成本
- ✅ **延迟影响小**：< 5ms
- ✅ **效果明显**：短句专名/术语错误下降 10-20%

### 2.3 S2：双通道解码 + 复核（Rescoring）

**原理**：对"短句 + 低置信/高风险"的文本块运行第二通道生成候选，再复核选择最优文本。

**候选来源**：
- **方案 A**：ASR N-best（一次解码输出 3-5 个候选）- 优先尝试
- **方案 B**：二次解码（同一音频再跑一次更保守解码）- 备选方案

**复核器（Rescorer）**：
- **RuleScore**：数字保护、专名保护、重复惩罚、字符集合理性
- **ContextScore**：与最近上下文的关键词重合度、一致性
- **NmtScore**（可选）：仅用于择优打分，不改写文本

**触发条件**（严格限制，目标触发率 ≤ 5%）：
- 短文本：CJK < 18 字符；EN < 9 words
- 低质量：quality_score < 0.45（offline）/ 0.50（room）
- 高风险特征：数字/金额/单位/时间、专名/品牌/产品名、同音高歧义词

---

## 3. 实施难度分析

### 3.1 总体评估

**实施难度**：🟢 **低-中**

| 阶段 | 难度 | 工作量 | 风险 | 周期 |
|------|------|--------|------|------|
| **阶段 1：S1 基础实现** | 🟢 低 | 1-2 周 | 🟢 低 | 1-2 周 |
| **阶段 2：S2 基础实现** | 🟡 中 | 2-3 周 | 🟡 中 | 2-3 周 |
| **阶段 3：S2 增强** | 🟡 中 | 2-3 周 | 🟡 中 | 2-3 周 |
| **总计** | 🟡 中 | 5-8 周 | 🟢 低 | **4-6 周**（并行） |

### 3.2 技术基础（已有）

✅ **已具备的基础设施**：
- `context_text` 参数支持（可传递到 ASR 服务）
- `use_text_context` 动态开关（基于质量分数）
- 质量评分机制（`quality_score`）
- 坏段检测（`detectBadSegment`）
- Aggregator 中间件架构（可在 Aggregator 之后触发）
- Beam Search 支持（`beam_size` 默认 10）

### 3.3 需要实现的功能

#### 阶段 1：S1 基础实现（1-2 周）

| 任务 | 难度 | 工作量 | 风险 |
|------|------|--------|------|
| PromptBuilder（关键词提取、上下文压缩） | 🟡 中 | 3-5 天 | 🟢 低 |
| ASR 接入 prompt（扩展 `context_text` 构建） | 🟢 低 | 1-2 天 | 🟢 低 |
| 测试和调优 | 🟢 低 | 2-3 天 | 🟢 低 |

**关键依赖**：无

#### 阶段 2：S2 基础实现（2-3 周）

| 任务 | 难度 | 工作量 | 风险 |
|------|------|--------|------|
| NeedRescore 判定函数 | 🟢 低 | 2-3 天 | 🟢 低 |
| 候选结构和 trace 字段 | 🟢 低 | 1-2 天 | 🟢 低 |
| Rescorer v1（RuleScore + ContextScore） | 🟡 中 | 3-5 天 | 🟡 中 |
| result_queue 扩展 | 🟢 低 | 1 天 | 🟢 低 |
| 测试和调优 | 🟡 中 | 3-5 天 | 🟢 低 |

**关键依赖**：需要验证 Faster Whisper 是否支持 N-best（如果不支持，使用二次解码）

#### 阶段 3：S2 增强（2-3 周，可选）

| 任务 | 难度 | 工作量 | 风险 |
|------|------|--------|------|
| N-best 接入（如果 Faster Whisper 支持） | 🟡 中 | 2-3 天 | 🟡 中 |
| 二次解码 worker（如果 N-best 不支持） | 🟡 中 | 3-5 天 | 🟡 中 |
| 音频缓存（Ring buffer + TTL） | 🟡 中 | 2-3 天 | 🟡 中 |
| 测试和调优 | 🟡 中 | 3-5 天 | 🟢 低 |

**关键依赖**：需要实现音频缓存机制

---

## 4. 风险评估

### 4.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 | 总体评估 |
|------|------|------|---------|---------|
| **Prompt 过长导致性能下降** | 中 | 中 | 严格长度限制（400-800 字符），压缩算法 | 🟢 低 |
| **Prompt 污染识别结果** | 高 | 低 | 基于质量分数动态开关，低质量禁用 | 🟢 低 |
| **Faster Whisper 不支持 N-best** | 中 | 中 | 使用二次解码作为备选方案 | 🟢 低 |
| **二次解码 GPU 过载** | 高 | 低 | 并发上限（每 GPU 1 个），超载降级 | 🟢 低 |
| **Rescorer 抖动** | 中 | 中 | Δscore margin（1.5），优势不足不替换 | 🟢 低 |
| **音频缓存内存占用** | 低 | 中 | Ring buffer，TTL 10 秒，大小限制 | 🟢 低 |

**总体技术风险**：🟢 **低**

### 4.2 业务风险

| 风险 | 影响 | 概率 | 缓解措施 | 总体评估 |
|------|------|------|---------|---------|
| **效果不明显** | 中 | 低 | 分阶段实施，及时调整参数 | 🟢 低 |
| **延迟增加过多** | 高 | 低 | 条件触发（≤ 5%），并发控制 | 🟢 低 |
| **用户感知不明显** | 低 | 中 | 指标监控，用户反馈收集 | 🟢 低 |

**总体业务风险**：🟢 **低**

### 4.3 风险缓解策略

1. **分阶段实施**：
   - 先实施 S1（低风险、快速见效）
   - 再实施 S2 基础版本（验证效果）
   - 最后实施 S2 增强（可选）

2. **严格触发控制**：
   - 目标触发率 ≤ 5%
   - 并发上限（每 GPU 1 个二次解码任务）
   - 超载自动降级

3. **充分测试**：
   - 每个阶段都要进行充分测试
   - 收集指标数据，及时调整参数

4. **回退机制**：
   - 所有功能都有开关控制
   - 可以快速回退到原始版本

---

## 5. 成本效益分析

### 5.1 开发成本

| 项目 | 工作量 | 人力成本 | 备注 |
|------|--------|---------|------|
| **阶段 1：S1 基础实现** | 1-2 周 | 1 人 | 低风险，快速见效 |
| **阶段 2：S2 基础实现** | 2-3 周 | 1 人 | 中等风险，效果明显 |
| **阶段 3：S2 增强** | 2-3 周 | 1 人 | 可选，根据效果决定 |
| **总计** | **4-6 周** | **1 人** | 可并行实施部分任务 |

### 5.2 运行成本

| 项目 | 成本 | 备注 |
|------|------|------|
| **S1：上下文偏置** | 几乎为零 | 主要是文本拼接，无 GPU 成本 |
| **S2：N-best 路径** | 低 | 无额外推理，CPU 后处理很小 |
| **S2：二次解码路径** | 中 | 额外 GPU 推理，但触发率低（≤ 5%） |

**总体运行成本**：🟢 **低**

### 5.3 预期收益

| 收益项 | 预期改善 | 业务价值 |
|--------|---------|---------|
| **短句专名/术语错误下降** | 20-30% | ✅ 高 |
| **同音字错误下降** | 30-40% | ✅ 高 |
| **用户满意度提升** | 15-20% | ✅ 高 |
| **系统可信度提升** | 显著 | ✅ 高 |

**投资回报率（ROI）**：✅ **高** - 开发成本低，效果明显，用户价值高

---

## 6. 时间线

### 6.1 实施计划

```
第 1-2 周：阶段 1 - S1 基础实现
  ├─ PromptBuilder 实现
  ├─ ASR 接入 prompt
  └─ 测试和调优

第 3-5 周：阶段 2 - S2 基础实现
  ├─ NeedRescore 判定函数
  ├─ Rescorer v1 实现
  ├─ result_queue 扩展
  └─ 测试和调优

第 6-8 周：阶段 3 - S2 增强（可选）
  ├─ N-best 接入或二次解码 worker
  ├─ 音频缓存实现
  └─ 测试和调优
```

### 6.2 里程碑

| 里程碑 | 时间 | 交付物 | 验收标准 |
|--------|------|--------|---------|
| **M1：S1 完成** | 第 2 周 | S1 功能上线 | 短句错误下降 10-20% |
| **M2：S2 基础完成** | 第 5 周 | S2 基础功能上线 | 短句错误下降 20-30%，触发率 ≤ 5% |
| **M3：S2 增强完成** | 第 8 周 | S2 增强功能上线 | 短句错误下降 30-40%，延迟可控 |

---

## 7. 与 Glossary 学习系统方案对比

### 7.1 方案对比

| 维度 | **本方案（S1+S2）** ⭐ | Glossary 学习系统 |
|------|---------------------|------------------|
| **实施难度** | 🟢 低-中 | 🟡 中-高 |
| **实施周期** | **4-6 周** | 7-11 周 |
| **技术风险** | 🟢 低 | 🟡 中 |
| **效果预期** | ✅ 可预期（基于成熟技术） | ⚠️ 需验证（创新方案） |
| **开发成本** | 🟢 低（1 人，4-6 周） | 🟡 中（1-2 人，7-11 周） |
| **运行成本** | 🟢 低 | 🟡 中 |
| **短期效果** | ✅ 快速见效（1-2 周） | ⚠️ 需要积累数据 |
| **长期价值** | 🟡 中 | 🟢 高 |
| **技术成熟度** | ✅ 成熟（基于 Faster Whisper 标准功能） | ⚠️ 创新（需要验证） |

### 7.2 决策建议

**推荐方案**：✅ **本方案（S1+S2）**

**理由**：
1. **快速见效**：1-2 周即可看到效果（S1）
2. **风险可控**：技术成熟，风险低
3. **成本合理**：开发成本低，运行成本低
4. **效果可预期**：基于成熟技术，效果可预期

**Glossary 学习系统**：
- 可作为**长期优化方向**，但需要更多验证
- 建议在**本方案实施完成并验证效果后**，再考虑是否实施

---

## 8. 成功指标

### 8.1 短期指标（1-2 个月）

| 指标 | 目标 | 测量方式 |
|------|------|---------|
| **短句专名/术语错误下降** | ≥ 20% | 人工抽样评估 |
| **同音字错误下降** | ≥ 30% | 人工抽样评估 |
| **S2 触发率** | ≤ 5% | 系统日志统计 |
| **P95 延迟增加** | ≤ 100ms | 系统监控 |
| **系统稳定性** | 无重大故障 | 系统监控 |

### 8.2 长期指标（3-6 个月）

| 指标 | 目标 | 测量方式 |
|------|------|---------|
| **短句错误总体下降** | ≥ 30% | 人工抽样评估 |
| **用户满意度提升** | ≥ 15% | 用户反馈 |
| **系统可信度提升** | 显著 | 用户反馈 |

---

## 9. 决策建议

### 9.1 推荐决策

✅ **批准实施本方案（S1+S2）**

**理由**：
1. **问题明确**：短句识别准确率偏低，影响用户体验
2. **方案可行**：技术成熟，实施难度低-中，风险可控
3. **效果可预期**：基于成熟技术，预期改善明显
4. **成本合理**：开发成本低（1 人，4-6 周），运行成本低
5. **快速见效**：1-2 周即可看到初步效果

### 9.2 实施建议

1. **分阶段实施**：
   - 优先实施 S1（低风险、快速见效）
   - 再实施 S2 基础版本（验证效果）
   - 最后实施 S2 增强（根据效果决定）

2. **充分测试**：
   - 每个阶段都要进行充分测试
   - 收集指标数据，及时调整参数

3. **持续监控**：
   - 监控触发率、延迟、错误率等指标
   - 收集用户反馈，持续优化

4. **回退机制**：
   - 所有功能都有开关控制
   - 可以快速回退到原始版本

### 9.3 放弃 Glossary 学习系统方案

**理由**：
1. **实施周期长**：7-11 周 vs 4-6 周
2. **技术风险高**：创新方案，需要更多验证
3. **效果不确定**：需要积累数据，效果不确定
4. **成本高**：开发成本高，运行成本中

**建议**：
- 作为**长期优化方向**，但需要更多验证
- 建议在**本方案实施完成并验证效果后**，再考虑是否实施

---

## 10. 附录

### 10.1 相关文档

- `ASR_SHORT_UTTERANCE_ACCURACY_CONTEXT_BIASING_AND_RESCORING_DESIGN.md` - 详细技术设计文档
- `ASR_SHORT_UTTERANCE_FEASIBILITY_ANALYSIS.md` - 可行性分析文档
- `AGGREGATOR_GLOSSARY_LEARNING_SYSTEM_PROPOSAL.md` - Glossary 学习系统提案（已放弃）

### 10.2 技术细节

**代码位置**：
- ASR 路由：`electron_node/electron-node/main/src/task-router/task-router.ts`
- 质量评分：`electron_node/electron-node/main/src/task-router/bad-segment-detector.ts`
- Aggregator 状态：`electron_node/electron-node/main/src/aggregator/aggregator-state.ts`
- ASR 服务：`electron_node/services/faster_whisper_vad/faster_whisper_vad_service.py`

### 10.3 联系方式

如有疑问，请联系技术团队。

---

**文档状态**：📋 **待审批**

**建议决策**：✅ **批准实施本方案（S1+S2）**

