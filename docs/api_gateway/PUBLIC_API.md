# å¯¹å¤–å¼€æ”¾ API è®¾è®¡ä¸å®ç°

ç‰ˆæœ¬ï¼šv1.0  
é€‚ç”¨å¯¹è±¡ï¼šåç«¯å¼€å‘ã€æ¶æ„å¸ˆã€ç§»åŠ¨ç«¯/SDK å¼€å‘å›¢é˜Ÿ

æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•å°† Lingua å®æ—¶è¯­éŸ³ç¿»è¯‘å¹³å°å¯¹å¤–å¼€æ”¾ï¼ŒåŒ…æ‹¬è®¾è®¡æ€è·¯ã€æ¶æ„æ–¹æ¡ˆã€å®ç°ç»†èŠ‚å’Œå¼€å‘æŒ‡å—ã€‚

---

## ç›®å½•

1. [èƒŒæ™¯ä¸ç›®æ ‡](#1-èƒŒæ™¯ä¸ç›®æ ‡)
2. [æ–°å¢èƒ½åŠ›æ¦‚è¿°](#2-æ–°å¢èƒ½åŠ›æ¦‚è¿°)
3. [æ¶æ„è®¾è®¡](#3-æ¶æ„è®¾è®¡)
4. [å®ç°æ–¹æ¡ˆ](#4-å®ç°æ–¹æ¡ˆ)
5. [å¤–éƒ¨ API è§„èŒƒ](#5-å¤–éƒ¨-api-è§„èŒƒ)
6. [å¼€å‘ä»»åŠ¡æ¸…å•](#6-å¼€å‘ä»»åŠ¡æ¸…å•)
7. [å®æ–½é˜¶æ®µ](#7-å®æ–½é˜¶æ®µ)
8. [å®ç°çŠ¶æ€](#8-å®ç°çŠ¶æ€)

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 å½“å‰ç³»ç»Ÿèƒ½åŠ›

å½“å‰ç³»ç»Ÿå·²ç»å…·å¤‡ï¼š

- å¤šä¼šè¯å®æ—¶è¯­éŸ³ç¿»è¯‘èƒ½åŠ›  
- åˆ†å¸ƒå¼ç¬¬ä¸‰æ–¹èŠ‚ç‚¹ï¼ˆElectron Nodeï¼‰ç®—åŠ›æ±   
- å¯æ’æ‹” ASR / NMT / TTS / å¯é€‰æ¨¡å—ï¼ˆæƒ…ç»ªã€è¯­é€Ÿã€éŸ³è‰²ç­‰ï¼‰  
- é¢å‘ç§»åŠ¨ App çš„å†…éƒ¨ WebSocket åè®®  

### 1.2 ç›®æ ‡

**æ‰©å±•ä¸ºä¸€ä¸ªå¯å¯¹å¤–å¼€æ”¾çš„è¯­éŸ³ç¿»è¯‘æœåŠ¡å¹³å°ï¼Œä½¿å¤–éƒ¨ APP / ç½‘ç«™ / å³æ—¶é€šä¿¡å·¥å…·ä¹Ÿå¯è°ƒç”¨æœ¬ç³»ç»Ÿã€‚**

æ­¤æ‰©å±•ä¸æ”¹å˜æ ¸å¿ƒæ¨ç†ä¸è°ƒåº¦é€»è¾‘ï¼Œåªæ·»åŠ é¢å‘ç¬¬ä¸‰æ–¹ä½¿ç”¨çš„å¤–å£³ã€é‰´æƒä¸å¤šç§Ÿæˆ·èƒ½åŠ›ã€‚

---

## 2. æ–°å¢èƒ½åŠ›æ¦‚è¿°

### 2.1 Public API Gatewayï¼ˆå¯¹å¤– API ç½‘å…³ï¼‰

æ–°å¢ä¸€ä¸ªç½‘å…³æœåŠ¡ï¼ŒèŒè´£ï¼š

- æä¾›ç¨³å®šã€æ–‡æ¡£åŒ–çš„ **REST API** + **WebSocket API**  
- éªŒè¯ç¬¬ä¸‰æ–¹ APP èº«ä»½ï¼ˆAPI Key / OAuth / JWTï¼‰  
- æ¥æ”¶å¤–éƒ¨éŸ³é¢‘è¾“å…¥ï¼Œå°†å…¶è½¬æ¢æˆå†…éƒ¨ `session_init` / `utterance` æ¶ˆæ¯  
- å°†å†…éƒ¨ `translation_result` è½¬æ¢æˆå¯¹å¤– API æ ¼å¼  
- è´Ÿè´£é™æµã€è®¡è´¹é’©å­ã€æ—¥å¿—ã€ç›‘æ§  

ç½‘å…³å……å½“æ¡¥æ¢ï¼š

```
å¤–éƒ¨ APP / Web / IM å·¥å…·
        â†“ HTTPS / WSS
[Public API Gateway]
        â†“ å†…éƒ¨ WS / RPC
[Scheduler] â†’ [Nodes]
```

### 2.2 å¤šç§Ÿæˆ·ç³»ç»Ÿ (Multi-Tenant)

æ¯ä¸ªå¤–éƒ¨ APP / ç½‘ç«™è§†ä¸ºä¸€ä¸ª **ç§Ÿæˆ·ï¼ˆtenantï¼‰**ã€‚æ–°å¢ï¼š

- `tenant_id`
- API Key æˆ– OAuth2 client ID/secret  
- æ¯ç§Ÿæˆ·çš„é…é¢ï¼ˆæœ€å¤§å¹¶å‘ä¼šè¯æ•° / è¯·æ±‚é¢‘ç‡ï¼‰  
- è®¡è´¹ç»Ÿè®¡ï¼ˆç´¯ç§¯ä½¿ç”¨é‡ã€èŠ‚ç‚¹æ—¶é—´ã€token ç­‰ï¼‰  

Scheduler éœ€è¦åœ¨ session/job ä¸­æºå¸¦ `tenant_id`ï¼Œç”¨äºï¼š  

- é™æµä¸ä¿æŠ¤ç³»ç»Ÿ  
- æœªæ¥å•†ä¸šåŒ–è®¡è´¹  

### 2.3 å¯¹å¤–åè®®åŒ…è£…ï¼ˆç®€åŒ–ï¼‰

å†…éƒ¨åè®®ï¼ˆsession_init/utteranceï¼‰ä¿ç•™ï¼Œå¤–éƒ¨æ¥å£åŒ…è£…æˆæ›´å‹å¥½çš„ APIï¼š

#### RESTï¼ˆéå®æ—¶/çŸ­ä¼šè¯ï¼‰

- `POST /v1/speech/translate`  
  ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œè¿”å›ç¿»è¯‘æ–‡æœ¬ + è¯­éŸ³ã€‚

#### WebSocketï¼ˆå®æ—¶æµå¼ç¿»è¯‘ï¼‰

- `/v1/stream`  
  å¤–éƒ¨å®¢æˆ·ç«¯å‘é€éŸ³é¢‘åˆ†ç‰‡ â†’ æ¥æ”¶å®æ—¶ç¿»è¯‘æ–‡æœ¬ä¸ TTS è¾“å‡ºã€‚

#### Webhookï¼ˆå¯é€‰ï¼‰

- è¿”å›ç¿»è¯‘ç»“æœç»™ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œé€‚åˆ IM å¹³å°ã€‚

### 2.4 SDKï¼ˆå¯é€‰ï¼‰

æä¾›è·¨å¹³å° SDK ä»¥ç®€åŒ–æ¥å…¥ï¼š

- JS Web SDK  
- iOS SDK  
- Android SDK  

SDK å†…éƒ¨ä½¿ç”¨ç½‘å…³åè®®ï¼Œå¯¹å¤–åªæš´éœ²ï¼š

```ts
const session = await lingua.startSession();
session.sendAudioChunk(chunk);
session.onResult((res) => console.log(res.text));
```

---

## 3. æ¶æ„è®¾è®¡

### 3.1 æ¶æ„å›¾

```
                   +-------------------------+
                   |    External App / Web   |
                   |  (IM, SaaS, Mobile App) |
                   +-------------+-----------+
                                 |
                           HTTPS / WSS
                                 |
                 +---------------v----------------+
                 |       Public API Gateway       |
                 | - Auth (API Key / OAuth)       |
                 | - Rate Limit / Billing         |
                 | - API v1 (REST + WebSocket)    |
                 +---------------+----------------+
                                 |
                       Internal WS / RPC
                                 |
                 +---------------v----------------+
                 |           Scheduler            |
                 | - Multi-tenant routing         |
                 | - Job dispatch                 |
                 +---------------+----------------+
                                 |
             -----------------------------------------
             |                 |                     |
   +---------v-----+  +--------v---------+  +--------v---------+
   |  Node Client  |  |  Node Client     |  |  Node Client     |
   | (Electron GPU)|  | (User PC GPU)    |  | (Cloud GPU)      |
   +---------------+  +------------------+  +------------------+
```

### 3.2 æ”¹åŠ¨èŒƒå›´

æ”¹åŠ¨é‡ **ä¸­ç­‰**ï¼Œæ— éœ€é‡æ„ï¼š

| æ¨¡å— | æ”¹åŠ¨é‡ | è¯´æ˜ |
|------|--------|------|
| Node æ¨ç†æœåŠ¡ | æ—  | å®Œå…¨å¤ç”¨ |
| Scheduler | å° | åŠ ç§Ÿæˆ·ã€é™æµã€é”™è¯¯ç  |
| WebSocket å†…éƒ¨åè®® | å° | å¢åŠ  tenant_id |
| Public API Gateway | æ–°å¢ | å¤–éƒ¨åº”ç”¨å…¥å£ |
| SDK | å¯é€‰ | æå‡ç¬¬ä¸‰æ–¹æ¥å…¥ä½“éªŒ |
| æ–‡æ¡£ | å¿…é¡»æ›´æ–° | API æ–‡æ¡£ã€å¼€å‘æŒ‡å— |

---

## 4. å®ç°æ–¹æ¡ˆ

### 4.1 é¡¹ç›®ç»“æ„

```
api-gateway/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ config.toml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs
â”‚   â”œâ”€â”€ config.rs
â”‚   â”œâ”€â”€ auth.rs          # é‰´æƒæ¨¡å—
â”‚   â”œâ”€â”€ tenant.rs        # ç§Ÿæˆ·ç®¡ç†
â”‚   â”œâ”€â”€ rate_limit.rs    # é™æµ
â”‚   â”œâ”€â”€ rest_api.rs      # REST API å¤„ç†
â”‚   â”œâ”€â”€ ws_api.rs        # WebSocket API å¤„ç†
â”‚   â””â”€â”€ scheduler_client.rs  # ä¸ Scheduler é€šä¿¡
â””â”€â”€ README.md
```

### 4.2 æŠ€æœ¯æ ˆ

**æ¨è**: Rust + Axumï¼ˆä¸ Scheduler ä¿æŒä¸€è‡´ï¼‰

**æ ¸å¿ƒä¾èµ–**:
- `tokio` - å¼‚æ­¥è¿è¡Œæ—¶
- `axum` - Web æ¡†æ¶
- `serde` / `serde_json` - åºåˆ—åŒ–
- `dashmap` - å¹¶å‘é™æµ
- `sha2` - API Key å“ˆå¸Œ
- `tokio-tungstenite` - WebSocket å®¢æˆ·ç«¯

### 4.3 æ ¸å¿ƒæ¨¡å—

#### 4.3.1 ç§Ÿæˆ·ç®¡ç† (`tenant.rs`)

**åŠŸèƒ½**:
- ç§Ÿæˆ·åˆ›å»ºå’Œç®¡ç†
- API Key éªŒè¯
- ç§Ÿæˆ·é…é¢ç®¡ç†

**å…³é”®ç»“æ„**:
```rust
pub struct Tenant {
    pub tenant_id: String,
    pub name: String,
    pub api_key_hash: String,
    pub max_concurrent_sessions: usize,
    pub max_requests_per_second: usize,
    pub enabled: bool,
}
```

#### 4.3.2 é‰´æƒä¸­é—´ä»¶ (`auth.rs`)

**åŠŸèƒ½**:
- ä»è¯·æ±‚ Header æå– API Key
- éªŒè¯ API Key å¹¶è·å– tenant_id
- å°† tenant_id æ³¨å…¥è¯·æ±‚æ‰©å±•

**æµç¨‹**:
```
è¯·æ±‚ â†’ æå– Authorization Header â†’ éªŒè¯ API Key â†’ è·å– tenant_id â†’ ç»§ç»­å¤„ç†
```

#### 4.3.3 é™æµæ¨¡å— (`rate_limit.rs`)

**åŠŸèƒ½**:
- ç§Ÿæˆ·çº§åˆ«çš„è¯·æ±‚é™æµ
- åŸºäºæ—¶é—´çª—å£çš„è®¡æ•°å™¨
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®¡æ•°å™¨

**å®ç°**:
- ä½¿ç”¨ `DashMap` å®ç°å¹¶å‘å®‰å…¨çš„è®¡æ•°å™¨
- æ¯ç§’é‡ç½®è®¡æ•°å™¨
- å®šæœŸæ¸…ç†è¿‡æœŸæ¡ç›®

#### 4.3.4 REST API (`rest_api.rs`)

**ç«¯ç‚¹**: `POST /v1/speech/translate`

**åŠŸèƒ½**:
- æ¥æ”¶ multipart/form-data éŸ³é¢‘æ–‡ä»¶
- åˆ›å»ºå†…éƒ¨ä¼šè¯
- å‘é€ utterance åˆ° Scheduler
- è¿”å›ç¿»è¯‘ç»“æœ

#### 4.3.5 WebSocket API (`ws_api.rs`)

**ç«¯ç‚¹**: `/v1/stream`

**åŠŸèƒ½**:
- å»ºç«‹ WebSocket è¿æ¥
- å¤„ç† `start` æ¶ˆæ¯ï¼ˆåˆ›å»ºä¼šè¯ï¼‰
- å¤„ç† `audio` æ¶ˆæ¯ï¼ˆå‘é€éŸ³é¢‘åˆ†ç‰‡ï¼‰
- è¿”å›å®æ—¶ç¿»è¯‘ç»“æœ

#### 4.3.6 Scheduler å®¢æˆ·ç«¯ (`scheduler_client.rs`)

**åŠŸèƒ½**:
- ä¸ Scheduler å»ºç«‹ WebSocket è¿æ¥
- å‘é€ `session_init` æ¶ˆæ¯ï¼ˆåŒ…å« tenant_idï¼‰
- å‘é€ `utterance` æ¶ˆæ¯
- æ¥æ”¶ `translation_result` æ¶ˆæ¯

### 4.4 Scheduler æ‰©å±•

#### 4.4.1 Session ç»“æ„æ‰©å±•

åœ¨ `scheduler/src/session.rs` ä¸­æ·»åŠ ï¼š

```rust
pub struct Session {
    // ... ç°æœ‰å­—æ®µ
    pub tenant_id: Option<String>, // æ–°å¢
}
```

#### 4.4.2 æ¶ˆæ¯åè®®æ‰©å±•

åœ¨ `scheduler/src/messages.rs` ä¸­æ‰©å±• `SessionInit`ï¼š

```rust
SessionInit {
    // ... ç°æœ‰å­—æ®µ
    tenant_id: Option<String>, // æ–°å¢
}
```

#### 4.4.3 ç§Ÿæˆ·é™æµï¼ˆå¯é€‰ï¼‰

å¯ä»¥æ·»åŠ ç§Ÿæˆ·çº§åˆ«çš„ä¼šè¯é™åˆ¶ï¼š

```rust
pub struct TenantLimiter {
    active_sessions: Arc<RwLock<HashMap<String, usize>>>,
    limits: Arc<RwLock<HashMap<String, TenantLimit>>>,
}
```

---

## 5. å¤–éƒ¨ API è§„èŒƒ

### 5.1 REST API

#### 5.1.1 ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶

**è¯·æ±‚**:
```
POST /v1/speech/translate
Authorization: Bearer <API_KEY>
Content-Type: multipart/form-data

audio: <binary>
src_lang: zh
tgt_lang: en
audio_format: pcm16 (å¯é€‰)
sample_rate: 16000 (å¯é€‰)
```

**å“åº”**:
```json
{
  "text": "The weather is nice today.",
  "audio_tts": "base64...",
  "duration_ms": 1530
}
```

**é”™è¯¯å“åº”**:
```json
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Invalid API key"
  }
}
```

### 5.2 WebSocket API

#### 5.2.1 è¿æ¥

```
wss://api.example.com/v1/stream
Authorization: Bearer <API_KEY>
```

#### 5.2.2 å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

**å¯åŠ¨ä¼šè¯**:
```json
{
  "type": "start",
  "src_lang": "zh",
  "tgt_lang": "en"
}
```

**å‘é€éŸ³é¢‘**:
```json
{
  "type": "audio",
  "chunk": "<base64-encoded-audio>"
}
```

#### 5.2.3 æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

**ä¼šè¯å·²å¯åŠ¨**:
```json
{
  "type": "started",
  "session_id": "sess-123456"
}
```

**ç¿»è¯‘ç»“æœ**:
```json
{
  "type": "final",
  "text": "ä»Šå¤©å¤©æ°”ä¸é”™ã€‚",
  "audio": "<base64-encoded-tts>"
}
```

**é”™è¯¯**:
```json
{
  "type": "error",
  "message": "Session not started"
}
```

---

## 6. å¼€å‘ä»»åŠ¡æ¸…å•

### 6.1 API Gateway å¼€å‘

- [x] åˆ›å»ºé¡¹ç›®ç»“æ„
- [x] å®ç°ç§Ÿæˆ·ç®¡ç†æ¨¡å— (`tenant.rs`)
- [x] å®ç°é‰´æƒä¸­é—´ä»¶ (`auth.rs`)
- [x] å®ç°é™æµæ¨¡å— (`rate_limit.rs`)
- [x] å®ç° REST API (`rest_api.rs`)
- [x] å®ç° WebSocket API (`ws_api.rs`)
- [x] å®ç° Scheduler å®¢æˆ·ç«¯ (`scheduler_client.rs`)
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

### 6.2 Scheduler æ‰©å±•

- [x] åœ¨ Session ä¸­æ·»åŠ  `tenant_id` å­—æ®µ
- [x] åœ¨æ¶ˆæ¯åè®®ä¸­æ·»åŠ  `tenant_id` æ”¯æŒ
- [ ] å®ç°ç§Ÿæˆ·é™æµå™¨ï¼ˆå¯é€‰ï¼‰
- [ ] åœ¨ä¼šè¯åˆ›å»ºæ—¶æ£€æŸ¥ç§Ÿæˆ·é™åˆ¶
- [ ] æ·»åŠ ç§Ÿæˆ·ç»Ÿè®¡å’Œç›‘æ§

### 6.3 SDK å¼€å‘ï¼ˆå¯é€‰ï¼‰

- [ ] JS Web SDK
- [ ] Android SDK
- [ ] iOS SDK
- [ ] SDK æ–‡æ¡£å’Œç¤ºä¾‹

---

## 7. å®æ–½é˜¶æ®µ

### é˜¶æ®µ 1ï¼ˆ1â€“2 å‘¨ï¼‰ï¼šå…¬å¸å†…éƒ¨ API è¯•è¿è¡Œ

- [x] å®ç° API Gateway åˆç‰ˆ  
- [x] REST / WebSocket éƒ½èƒ½è°ƒç”¨å†…éƒ¨ pipeline  
- [x] æ·»åŠ  tenant_id æ”¯æŒ  

### é˜¶æ®µ 2ï¼ˆ1â€“2 å‘¨ï¼‰ï¼šç¨³å®šåŒ– + SDK

- [ ] å¢åŠ é™æµã€é‰´æƒå®Œå–„
- [ ] å‘å¸ƒ JS SDK  
- [ ] å®Œå–„é”™è¯¯å¤„ç†

### é˜¶æ®µ 3ï¼ˆ2â€“4 å‘¨ï¼‰ï¼šå¤–éƒ¨åˆä½œä¼™ä¼´æ¥å…¥

- [ ] å‡†å¤‡ API æ–‡æ¡£  
- [ ] å¢åŠ è®¡è´¹é’©å­  
- [ ] å¼€æ”¾ç¬¬ä¸€æ‰¹å¤–éƒ¨ä½¿ç”¨  

---

## 8. å®ç°çŠ¶æ€

### 8.1 âœ… å·²å®Œæˆ

1. **API Gateway é¡¹ç›®æ¡†æ¶**
   - é¡¹ç›®ç»“æ„å·²åˆ›å»º
   - æ ¸å¿ƒæ¨¡å—å·²å®ç°
   - é…ç½®æ–‡ä»¶å·²è®¾ç½®

2. **Scheduler æ‰©å±•**
   - Session ç»“æ„å·²æ·»åŠ  `tenant_id` å­—æ®µ
   - æ¶ˆæ¯åè®®å·²æ”¯æŒ `tenant_id`
   - `create_session` æ–¹æ³•å·²æ›´æ–°

3. **æ ¸å¿ƒåŠŸèƒ½**
   - ç§Ÿæˆ·ç®¡ç†æ¨¡å—
   - API Key é‰´æƒ
   - é™æµæœºåˆ¶
   - REST API ç«¯ç‚¹
   - WebSocket API ç«¯ç‚¹
   - Scheduler å®¢æˆ·ç«¯

### 8.2 âš ï¸ å¾…å®Œå–„

1. **é”™è¯¯å¤„ç†**
   - ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
   - é”™è¯¯æ—¥å¿—è®°å½•
   - é”™è¯¯ç›‘æ§

2. **æµ‹è¯•**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

3. **æ–‡æ¡£**
   - API æ–‡æ¡£ï¼ˆOpenAPI/Swaggerï¼‰
   - ä½¿ç”¨ç¤ºä¾‹
   - SDK æ–‡æ¡£

4. **ç”Ÿäº§ç¯å¢ƒå‡†å¤‡**
   - æ•°æ®åº“é›†æˆï¼ˆç§Ÿæˆ·å­˜å‚¨ï¼‰
   - ç›‘æ§å’Œå‘Šè­¦
   - æ—¥å¿—èšåˆ
   - é…ç½®ç®¡ç†

### 8.3 ğŸ”„ åç»­ä¼˜åŒ–

1. **OAuth2 æ”¯æŒ**: æ›´çµæ´»çš„é‰´æƒæ–¹å¼
2. **Webhook**: æ”¯æŒå¼‚æ­¥å›è°ƒ
3. **è®¡è´¹ç³»ç»Ÿ**: é›†æˆè®¡è´¹å’Œè´¦å•
4. **ç›‘æ§é¢æ¿**: ç§Ÿæˆ·ä½¿ç”¨æƒ…å†µå¯è§†åŒ–
5. **API ç‰ˆæœ¬ç®¡ç†**: æ”¯æŒå¤šç‰ˆæœ¬ API

---

## 9. å®‰å…¨è€ƒè™‘

1. **API Key ç®¡ç†**: ä½¿ç”¨å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼ˆSHA256ï¼‰å­˜å‚¨
2. **HTTPS/WSS**: å¼ºåˆ¶ä½¿ç”¨åŠ å¯†è¿æ¥
3. **é™æµ**: é˜²æ­¢æ»¥ç”¨å’Œ DDoS
4. **è¾“å…¥éªŒè¯**: éªŒè¯æ‰€æœ‰å¤–éƒ¨è¾“å…¥
5. **é”™è¯¯ä¿¡æ¯**: é¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯
6. **CORS**: é…ç½®é€‚å½“çš„è·¨åŸŸç­–ç•¥

---

## 10. éƒ¨ç½²å»ºè®®

1. **API Gateway** ç‹¬ç«‹éƒ¨ç½²ï¼Œå¯æ°´å¹³æ‰©å±•
2. **Scheduler** ä¿æŒç°æœ‰éƒ¨ç½²æ–¹å¼
3. **ç›‘æ§å’Œæ—¥å¿—** ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
4. **é…ç½®ç®¡ç†** ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒ
5. **æ•°æ®åº“** ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ PostgreSQL/MySQL å­˜å‚¨ç§Ÿæˆ·ä¿¡æ¯

---

## 11. ç»“è®º

å¯¹å¤–å¼€æ”¾ API **ä¸éœ€è¦å¤§æ”¹æ¶æ„**ï¼š  
- æ ¸å¿ƒè°ƒåº¦ã€èŠ‚ç‚¹ç®—åŠ›æ± ã€æ¨¡å‹æ¨¡å—åŒ–å…¨éƒ¨ä¿ç•™ï¼›  
- æ–°å¢çš„åªæœ‰ API Gateway + å¤šç§Ÿæˆ·æ”¯æŒï¼›  
- æ€»ä½“å®ç°æˆæœ¬å¯æ§ï¼Œæ”¶ç›Šæ˜¾è‘—ï¼Œå¯æˆä¸ºé•¿æœŸå¹³å°åŒ–æˆ˜ç•¥åŸºç¡€ã€‚

---

## é™„å½•

### A. é…ç½®æ–‡ä»¶ç¤ºä¾‹

**API Gateway** (`api-gateway/config.toml`):
```toml
[server]
port = 8081
host = "0.0.0.0"

[scheduler]
url = "ws://localhost:8080/ws/session"

[rate_limit]
default_max_rps = 100
default_max_sessions = 10
```

### B. å¿«é€Ÿå¼€å§‹

1. å¯åŠ¨ Scheduler:
```bash
cd scheduler
cargo run
```

2. å¯åŠ¨ API Gateway:
```bash
cd api-gateway
cargo run
```

3. æµ‹è¯• REST API:
```bash
curl -X POST http://localhost:8081/v1/speech/translate \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -F "audio=@audio.wav" \
  -F "src_lang=zh" \
  -F "tgt_lang=en"
```

### C. ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](../ARCHITECTURE.md)
- [åè®®è§„èŒƒ](../PROTOCOLS.md)
- [æ¨¡å—åŒ–åŠŸèƒ½è®¾è®¡](../modular/MODULAR_FEATURES.md)

