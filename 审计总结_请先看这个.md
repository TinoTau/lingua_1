# ⚠️  Pool 系统审计 - 重要发现

**日期**: 2026-01-21  
**状态**: 🔴 需要立即决策

---

## 核心结论

经过仔细检查旧系统的测试文件，发现：

### 🔴 不能简单删除旧系统！

**原因**：
1. 旧系统有**服务能力检查**（ASR/NMT/TTS/Semantic 是否就绪）
2. 旧系统有**Semantic 语言验证**（防止语义修复失败）
3. 旧系统有**服务热插拔支持**（能力变化时自动更新 Pool）
4. 旧系统有**Session Affinity**（AudioAggregator 连续性）

### 🔴 新系统功能不完整！

新系统虽然代码简洁（260行），但**缺失上述所有功能**。

---

## 现在的状况

```
✅ 节点注册：使用新系统
✅ 节点心跳：使用新系统
🔴 任务调度：使用旧系统
🔴 代码编译：❌ 失败（NodeRegistry 仍依赖旧模块）
```

---

## 需要立即回答的问题

### 给节点端团队

**Q1**: 节点端能否保证**只在 ASR+NMT+TTS 都就绪时才上报语言对**？
- [ ] 是（新系统可保持极简）
- [ ] 否（需要服务端检查）

**Q2**: 节点端能否保证 **semantic_languages 包含完整语言**？
- [ ] 是（可以降级处理）
- [ ] 否（需要服务端检查）

**Q3**: 节点端能否**服务故障时自动断开连接**？
- [ ] 是（新系统不需要处理）
- [ ] 否（可能分配到故障节点）

**Q4**: 节点端能否**能力变化时重新连接**？
- [ ] 是（不需要热插拔）
- [ ] 否（需要热插拔支持）

### 给 AudioAggregator 团队

**Q5**: AudioAggregator 是否**必须在同一节点连续处理**？
- [ ] 是（需要 Session Affinity）
- [ ] 否（Job Affinity 够用）

---

## 三个路径

### 路径 A：完整重构（2-3 天）

**添加所有缺失功能**
- 代码量：~800 行
- 工作量：2-3 天
- 风险：低
- 收益：代码减少 78%

### 路径 B：极简重构（1 天）✅ 推荐

**保持极简，节点端保证**
- 代码量：260 行
- 工作量：1 天
- 风险：中（依赖节点端）
- 收益：代码减少 93%

**前提**：Q1-Q4 都是"是"，Q5 是"否"

### 路径 C：暂停重构（2 小时）

**回滚，保持现状**
- 代码量：3500 行
- 工作量：2 小时（回滚）
- 风险：无
- 收益：无

---

## 推荐决策流程

```
1. 今天下午：技术讨论会（1小时）
   → 回答 Q1-Q5

2. 今天晚上：决策部门审批（30分钟）
   → 选择路径 A/B/C

3. 明天开始：执行实施
   → 路径 A: 2-3 天
   → 路径 B: 1 天
   → 路径 C: 2 小时回滚
```

---

## 详细文档

### 按优先级阅读

1. **本文档**（3 分钟）- 核心结论
2. [决策请求](./POOL_MIGRATION_DECISION_REQUIRED.md)（5 分钟）- 5 个问题
3. [旧系统分析](./POOL_OLD_SYSTEM_ANALYSIS.md)（15 分钟）- 测试证据
4. [节点端规范](./NODE_CLIENT_CAPABILITY_REQUIREMENTS.md)（10 分钟）- 如果选路径 B

### 完整索引

查看 [文档索引](./POOL_AUDIT_INDEX.md) 了解所有文档。

---

## 联系方式

**技术问题**: 查阅详细文档  
**决策咨询**: 召开技术讨论会

---

**创建时间**: 2026-01-21  
**更新时间**: 2026-01-21  
**紧急程度**: 🔴 P0（代码无法编译）
