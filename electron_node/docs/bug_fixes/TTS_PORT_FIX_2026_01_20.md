# TTSç«¯å£é…ç½®ä¿®å¤
**æ—¶é—´**: 2026-01-20 11:06
**é—®é¢˜**: Piper TTSç«¯å£ä¸åŒ¹é…å¯¼è‡´é›†æˆæµ‹è¯•æ— è¿”å›

---

## ğŸ› **é—®é¢˜æè¿°**

### ç—‡çŠ¶
- âœ… ASRï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰æˆåŠŸ
- âœ… NMTï¼ˆç¿»è¯‘ï¼‰æˆåŠŸ
- âŒ TTSï¼ˆè¯­éŸ³åˆæˆï¼‰å¤±è´¥ï¼š`ECONNREFUSED 127.0.0.1:5009`
- âŒ æœ€ç»ˆç»“æœï¼šæ— éŸ³é¢‘è¿”å›

### æ ¹æœ¬åŸå› 
**ç«¯å£é…ç½®ä¸åŒ¹é…**ï¼š
- é…ç½®æ–‡ä»¶ `service.json`ï¼š`port: 5009`
- PythonæœåŠ¡å®é™…ç›‘å¬ï¼š`port: 5005`
- ç³»ç»ŸæœŸæœ›è¿æ¥ï¼š`port: 5009`

---

## ğŸ” **è¯Šæ–­è¿‡ç¨‹**

### Step 1: æ£€æŸ¥æ—¥å¿—
```json
{
  "error": "connect ECONNREFUSED 127.0.0.1:5009",
  "translatedText": "We are starting a sound stability test.",
  "msg": "TTSStage: TTS task failed"
}
```

### Step 2: æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -ano | findstr "5005"
# ç»“æœï¼šTCP 0.0.0.0:5005 LISTENING 26184
```

### Step 3: æ£€æŸ¥é…ç½®æ–‡ä»¶
```json
// services/piper_tts/service.json
{
  "port": 5009  // âœ… é…ç½®ä¸º5009
}
```

### Step 4: æ£€æŸ¥PythonæœåŠ¡è„šæœ¬
```python
# piper_http_server.py:139
parser.add_argument(
    "--port",
    type=int,
    default=5005,  // âŒ ç¡¬ç¼–ç ä¸º5005
    help="Port to bind to (default: 5005)"
)
```

**ç»“è®º**ï¼šPythonè„šæœ¬å¿½ç•¥äº†`service.json`ï¼Œä½¿ç”¨ç¡¬ç¼–ç çš„é»˜è®¤å€¼5005ã€‚

---

## âœ… **ä¿®å¤æ–¹æ¡ˆ**

### ä¿®æ”¹å†…å®¹
**æ–‡ä»¶**: `services/piper_tts/piper_http_server.py`

**ä¿®æ”¹å‰**:
```python
parser.add_argument(
    "--port",
    type=int,
    default=5005,
    help="Port to bind to (default: 5005)"
)
```

**ä¿®æ”¹å**:
```python
parser.add_argument(
    "--port",
    type=int,
    default=5009,
    help="Port to bind to (default: 5009)"
)
```

---

## ğŸš€ **éªŒè¯æ­¥éª¤**

### Step 1: é‡å¯TTSæœåŠ¡
```powershell
# åœ¨èŠ‚ç‚¹ç«¯UIä¸­ï¼š
# 1. åœæ­¢ piper-tts æœåŠ¡
# 2. å¯åŠ¨ piper-tts æœåŠ¡
```

### Step 2: éªŒè¯ç«¯å£
```powershell
netstat -ano | findstr "5009"
# æœŸæœ›ç»“æœï¼šTCP 0.0.0.0:5009 LISTENING [PID]
```

### Step 3: é‡æ–°è¿è¡Œé›†æˆæµ‹è¯•
æµ‹è¯•æ–‡æœ¬ç¿»è¯‘ä»»åŠ¡ï¼ŒéªŒè¯æ˜¯å¦æœ‰éŸ³é¢‘è¿”å›ã€‚

---

## ğŸ“Š **å½±å“èŒƒå›´**

### å—å½±å“çš„åŠŸèƒ½
- âœ… æ‰€æœ‰éœ€è¦TTSçš„ä»»åŠ¡
- âœ… è¯­éŸ³ç¿»è¯‘çš„å®Œæ•´æµç¨‹
- âœ… æ‰€æœ‰è¯­è¨€å¯¹çš„TTSè¾“å‡º

### ä¸å—å½±å“çš„åŠŸèƒ½
- âœ… ASRï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰
- âœ… NMTï¼ˆç¿»è¯‘ï¼‰
- âœ… è¯­ä¹‰ä¿®å¤
- âœ… æœåŠ¡å‘ç°å’Œæ³¨å†Œ

---

## ğŸ¯ **å…¶ä»–å‘ç°**

### æ¬¡è¦é—®é¢˜1ï¼šASRé•¿éŸ³é¢‘è¶…æ—¶
```json
{
  "audioDurationMs": 22360,
  "timeout": 30000,
  "actual": 32137,
  "msg": "ASR processing timeout"
}
```

**å»ºè®®**ï¼šå¢åŠ ASRè¶…æ—¶æ—¶é—´åˆ°60ç§’ã€‚

### æ¬¡è¦é—®é¢˜2ï¼šSessionAffinityManagerè­¦å‘Š
```json
{
  "msg": "SessionAffinityManager: Cannot record timeout finalize, nodeId not set"
}
```

**å½±å“**ï¼šè­¦å‘Šçº§åˆ«ï¼Œä¸å½±å“åŠŸèƒ½ã€‚

---

## ğŸ“ **æ€»ç»“**

### é—®é¢˜
**Piper TTSæœåŠ¡ç«¯å£ç¡¬ç¼–ç ä¸º5005ï¼Œè€Œç³»ç»Ÿé…ç½®å’ŒæœŸæœ›ç«¯å£ä¸º5009ã€‚**

### ä¿®å¤
**ä¿®æ”¹piper_http_server.pyçš„é»˜è®¤ç«¯å£ä»5005æ”¹ä¸º5009ã€‚**

### éªŒè¯
**é‡å¯TTSæœåŠ¡åï¼ŒéªŒè¯ç«¯å£ç›‘å¬åœ¨5009ï¼Œç„¶åé‡æ–°æµ‹è¯•ã€‚**

---

**é—®é¢˜ç±»å‹**: é…ç½®ä¸åŒ¹é…  
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜ - é˜»å¡æ‰€æœ‰TTSåŠŸèƒ½  
**ä¿®å¤æ—¶é—´**: 2åˆ†é’Ÿ  
**éªŒè¯æ—¶é—´**: 3åˆ†é’Ÿ  
**çŠ¶æ€**: âœ… å·²ä¿®å¤
