# Job2到Job20问题分析

## 问题现象

从job2到job20之间，用户说了好几句话都没有返回结果，只有job20最终返回了结果。

## 日志分析

### 主要问题

1. **ASR识别质量差**：
   - 很多job的ASR文本都是相同的："一句的回应出现"（7个字符）
   - 很多job的ASR结果是空的（`asrTextLength: 0`）
   - 例如：job9, job11, job13的ASR结果都是空的

2. **TextForwardMergeManager等待合并机制**：
   - 很多job的ASR文本长度在6-16字符之间，被标记为`shouldWaitForMerge=true`
   - 等待3秒超时后，如果文本仍然太短（<6字符），就会被丢弃
   - 例如：
     - job7: 12字符，等待合并，超时后被丢弃
     - job10: 12字符，等待合并，超时后被丢弃
     - job16: 7字符，等待合并，超时后被丢弃
     - job18: 7字符，等待合并，超时后被丢弃

3. **文本去重导致丢弃**：
   - job21的ASR文本（15字符）与job20的文本（16字符）去重后，只剩下1个字符（"事"），被丢弃

### 具体Job处理流程

#### Job2 (utteranceIndex: 2)
- ASR文本长度: 40字符
- 处理: 直接发送给语义修复（>16字符）
- 结果: ✅ 成功返回

#### Job3-19 (utteranceIndex: 3-19)
- 大部分job的ASR文本长度在6-16字符之间
- 处理: 被标记为`shouldWaitForMerge=true`，等待与下一句合并
- 结果: ❌ 3秒超时后，如果文本仍然太短，被丢弃

#### Job20 (utteranceIndex: 20)
- ASR文本长度: 16字符（刚好等于阈值）
- 处理: 直接发送给语义修复（>=16字符）
- 结果: ✅ 成功返回

## 根本原因

1. **ASR识别质量问题**：
   - 很多短句被重复识别为"一句的回应出现"
   - 很多job的ASR结果是空的

2. **TextForwardMergeManager的等待合并机制过于严格**：
   - 6-16字符的文本被等待合并，但3秒超时后如果仍然太短就被丢弃
   - 这导致很多有效的短句被丢弃

3. **文本去重逻辑问题**：
   - job21的文本与job20的文本去重后，只剩下1个字符，被丢弃
   - 这可能是因为去重逻辑过于激进

## 建议的修复方案

1. **改进ASR识别质量**：
   - 检查为什么很多短句被重复识别为"一句的回应出现"
   - 检查为什么很多job的ASR结果是空的

2. **调整TextForwardMergeManager的等待合并机制**：
   - 如果手动截断（`isManualCut=true`），即使文本长度在6-16字符之间，也应该直接发送给语义修复
   - 减少等待超时时间，或者改进超时后的处理逻辑

3. **改进文本去重逻辑**：
   - 如果去重后文本太短（<6字符），应该保留原始文本，而不是丢弃
   - 或者改进去重算法，避免过度去重
