# Semantic Repair 英文语义修复服务 - 快速测试命令

## 服务地址
- **URL**: http://127.0.0.1:5011
- **端口**: 5011

## 快速测试命令

### 1. 健康检查（最简单）
```powershell
Invoke-RestMethod -Uri "http://127.0.0.1:5011/health"
```

### 2. 测试修复功能（单行命令）
```powershell
$body = @{job_id="test";session_id="test";text_in="Hello, this is a test text.";lang="en"} | ConvertTo-Json; Invoke-RestMethod -Uri "http://127.0.0.1:5011/repair" -Method Post -Body $body -ContentType "application/json"
```

### 3. 测试修复功能（格式化输出）
```powershell
$body = @{
    job_id = "test_job_001"
    session_id = "test_session_001"
    text_in = "Hello, this is a test text."
    lang = "en"
} | ConvertTo-Json

$result = Invoke-RestMethod -Uri "http://127.0.0.1:5011/repair" -Method Post -Body $body -ContentType "application/json"

Write-Host "Input: $($body | ConvertFrom-Json | Select-Object -ExpandProperty text_in)" -ForegroundColor Cyan
Write-Host "Output: $($result.text_out)" -ForegroundColor Green
Write-Host "Decision: $($result.decision)" -ForegroundColor Yellow
Write-Host "Confidence: $($result.confidence)" -ForegroundColor Yellow
Write-Host "Time: $($result.repair_time_ms) ms" -ForegroundColor Gray
```

### 4. 测试典型 ASR 错误场景

#### 测试拼写错误修复
```powershell
$body = @{
    job_id = "test_spelling"
    session_id = "test"
    text_in = "I want to buy a api"  # 应该是 "API"
    lang = "en"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5011/repair" -Method Post -Body $body -ContentType "application/json"
```

#### 测试简单文本（应该保持原样）
```powershell
$body = @{
    job_id = "test_simple"
    session_id = "test"
    text_in = "Today is a good day"
    lang = "en"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://127.0.0.1:5011/repair" -Method Post -Body $body -ContentType "application/json"
```

## 使用 curl（如果安装了）

### 健康检查
```bash
curl http://127.0.0.1:5011/health
```

### 测试修复
```bash
curl -X POST http://127.0.0.1:5011/repair ^
  -H "Content-Type: application/json" ^
  -d "{\"job_id\":\"test\",\"session_id\":\"test\",\"text_in\":\"Hello, this is a test.\",\"lang\":\"en\"}"
```

## 预期结果

### 健康检查响应
```json
{
  "status": "healthy",
  "model_loaded": true,
  "model_version": "qwen2.5-3b-instruct-q4_k_m.gguf",
  "warmed": true
}
```

### 修复响应
```json
{
  "decision": "PASS" 或 "REPAIR",
  "text_out": "修复后的文本",
  "confidence": 0.85,
  "diff": [],
  "reason_codes": [],
  "repair_time_ms": 100-500
}
```

## 性能指标（GPU 模式）

- **响应时间**: 100-500 ms（之前 CPU 模式是 ~4000ms）
- **CPU 使用率**: 低（大部分计算在 GPU 上）
- **GPU 使用率**: 高（推理时）

## 注意事项

1. 服务启动需要 20-30 秒（模型加载和预热）
2. 首次请求可能稍慢（模型预热）
3. 确保服务已完全启动后再测试
