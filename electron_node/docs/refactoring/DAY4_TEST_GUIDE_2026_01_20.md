# Day 4 æµ‹è¯•æŒ‡å— - 2026-01-20

## ğŸ¯ **æµ‹è¯•ç›®æ ‡**

éªŒè¯ ServiceProcessRunner ç»Ÿä¸€æ¶æ„åçš„åŠŸèƒ½å®Œæ•´æ€§ã€‚

---

## ğŸ“‹ **æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤**

### 1. é‡å¯ Electron

```bash
# å…³é—­å½“å‰ Electron
# é‡æ–°å¯åŠ¨
cd d:\Programs\github\lingua_1\electron_node\electron-node
npm start
```

---

### 2. åŸºæœ¬åŠŸèƒ½æµ‹è¯•

#### A. æœåŠ¡åˆ—è¡¨æ˜¾ç¤º
```
æœŸæœ›: çœ‹åˆ°æ‰€æœ‰9ä¸ªæœåŠ¡
- faster-whisper-vad (ASR)
- nmt-m2m100 (NMT)
- piper-tts (TTS)
- semantic-repair-zh (è¯­ä¹‰ä¿®å¤-ä¸­æ–‡)
- semantic-repair-en-zh (ç»Ÿä¸€è¯­ä¹‰ä¿®å¤)
- en-normalize (è‹±æ–‡è§„èŒƒåŒ–)
- speaker-embedding (éŸ³è‰²)
- your-tts (TTS)
- node-inference (æ¨ç†)
```

#### B. å¯åŠ¨æœåŠ¡
```
æ“ä½œ:
1. ç‚¹å‡»å¯åŠ¨ä»»æ„æœåŠ¡ï¼ˆå¦‚ faster-whisper-vadï¼‰
2. è§‚å¯ŸçŠ¶æ€å˜åŒ–: stopped â†’ starting â†’ running

æœŸæœ›:
âœ… çŠ¶æ€æ­£ç¡®å˜åŒ–
âœ… æ— é”™è¯¯æç¤º
âœ… æ—¥å¿—æ¸…æ™°ï¼ˆæ— consoleè¾“å‡ºï¼‰
```

#### C. åœæ­¢æœåŠ¡
```
æ“ä½œ:
1. ç‚¹å‡»åœæ­¢å·²è¿è¡Œçš„æœåŠ¡
2. è§‚å¯ŸçŠ¶æ€å˜åŒ–: running â†’ stopping â†’ stopped

æœŸæœ›:
âœ… ä¼˜é›…å…³é—­
âœ… ç«¯å£é‡Šæ”¾ï¼ˆ3ç§’å†…ï¼‰
âœ… æ— é”™è¯¯
```

#### D. é‡å¯æœåŠ¡
```
æ“ä½œ:
1. åœæ­¢æœåŠ¡
2. ç«‹å³å¯åŠ¨æœåŠ¡

æœŸæœ›:
âœ… ç«¯å£å†²çªå·²è§£å†³
âœ… æœåŠ¡æˆåŠŸå¯åŠ¨
âœ… æ— "Port already in use"é”™è¯¯
```

---

### 3. åˆ·æ–°æœåŠ¡æµ‹è¯•

```
æ“ä½œ:
1. å¯åŠ¨2-3ä¸ªæœåŠ¡
2. ç‚¹å‡»"åˆ·æ–°æœåŠ¡"æŒ‰é’®
3. è§‚å¯ŸæœåŠ¡çŠ¶æ€

æœŸæœ›:
âœ… è¿è¡Œä¸­çš„æœåŠ¡ä¿æŒè¿è¡Œ
âœ… æœåŠ¡åˆ—è¡¨æ›´æ–°
âœ… æ— æœåŠ¡è¢«æ„å¤–åœæ­¢
```

---

### 4. æ—¥å¿—æ£€æŸ¥

#### A. æ—  console è¾“å‡º
```
æ“ä½œ: å¯åŠ¨/åœæ­¢æœåŠ¡
æœŸæœ›: Electron DevTools Console ä¸­æ—  console.log/error è¾“å‡º
```

#### B. Logger è¾“å‡ºæ¸…æ™°
```
æ—¥å¿—æ–‡ä»¶: electron-node/logs/electron-main.log

æœŸæœ›æ—¥å¿—æ ¼å¼:
{"level":30,"msg":"ğŸš€ Starting service process"}
{"level":30,"msg":"â³ Service process spawned, starting health check..."}
{"level":30,"msg":"âœ… Service is now running"}
{"level":30,"msg":"ğŸ›‘ Stopping service"}
{"level":30,"msg":"âœ… Service stopped and cleaned up"}
```

---

### 5. é”™è¯¯å¤„ç†æµ‹è¯•

#### A. å¯åŠ¨å·²è¿è¡Œçš„æœåŠ¡
```
æ“ä½œ: å¯¹è¿è¡Œä¸­çš„æœåŠ¡ç‚¹å‡»"å¯åŠ¨"
æœŸæœ›: æ˜¾ç¤ºé”™è¯¯ "Service already running"
```

#### B. ç«¯å£å ç”¨
```
æ“ä½œ: å¯åŠ¨å ç”¨ç«¯å£çš„æœåŠ¡
æœŸæœ›: æ˜¾ç¤ºé”™è¯¯ "Port XXX is already in use"
```

#### C. æœåŠ¡ä¸å­˜åœ¨
```
æ“ä½œ: å°è¯•å¯åŠ¨ä¸å­˜åœ¨çš„æœåŠ¡
æœŸæœ›: æ˜¾ç¤ºé”™è¯¯ "Service not found"
```

---

## ğŸ” **å…³é”®éªŒè¯ç‚¹**

### 1. NodeServiceSupervisor å·²åˆ é™¤
```bash
# ç¡®è®¤æ–‡ä»¶å·²åˆ é™¤
ls d:\Programs\github\lingua_1\electron_node\electron-node\main\src\service-layer\NodeServiceSupervisor.ts
# åº”è¯¥æ˜¾ç¤º: æ‰¾ä¸åˆ°æ–‡ä»¶
```

### 2. API ç»Ÿä¸€
```typescript
// âœ… æ–°API
runner.start(id)
runner.stop(id)
runner.getAllStatuses()

// âŒ æ—§APIï¼ˆåº”è¯¥ä¸å­˜åœ¨ï¼‰
supervisor.startService(id)
supervisor.listServices()
```

### 3. ç¼–è¯‘æˆåŠŸ
```bash
npm run build:main
# åº”è¯¥æ˜¾ç¤º: âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
```

---

## ğŸ› **é—®é¢˜æ’æŸ¥**

### å¦‚æœæœåŠ¡æ— æ³•å¯åŠ¨
1. æ£€æŸ¥ electron-main.log ä¸­çš„é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤ service.json é…ç½®æ­£ç¡®
3. ç¡®è®¤ç«¯å£æœªè¢«å ç”¨

### å¦‚æœåˆ·æ–°æœåŠ¡åæœåŠ¡åœæ­¢
1. è¿™æ˜¯**é”™è¯¯**ï¼ŒDay 4åº”è¯¥å·²ä¿®å¤
2. æ£€æŸ¥ services:refresh IPC handler
3. ç¡®è®¤ runtime çŠ¶æ€ä¿ç•™é€»è¾‘

### å¦‚æœå‡ºç°ç¼–è¯‘é”™è¯¯
1. æ£€æŸ¥æ˜¯å¦æœ‰æ®‹ç•™çš„ NodeServiceSupervisor å¼•ç”¨
2. è¿è¡Œ `npm run build:main` æŸ¥çœ‹è¯¦ç»†é”™è¯¯
3. æŠ¥å‘Šç»™å¼€å‘è€…

---

## âœ… **æµ‹è¯•é€šè¿‡æ ‡å‡†**

- [ ] æœåŠ¡åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] å¯åŠ¨æœåŠ¡åŠŸèƒ½æ­£å¸¸
- [ ] åœæ­¢æœåŠ¡åŠŸèƒ½æ­£å¸¸
- [ ] é‡å¯æœåŠ¡åŠŸèƒ½æ­£å¸¸
- [ ] åˆ·æ–°æœåŠ¡ä¸åœæ­¢è¿è¡Œä¸­çš„æœåŠ¡
- [ ] æ—  console è¾“å‡º
- [ ] Logger æ—¥å¿—æ¸…æ™°
- [ ] é”™è¯¯æ­£ç¡®æ˜¾ç¤º
- [ ] NodeAgent å¿ƒè·³æ­£å¸¸
- [ ] ç¼–è¯‘æ— é”™è¯¯

**å…¨éƒ¨é€šè¿‡ = Day 4 éªŒè¯æˆåŠŸ**

---

**æµ‹è¯•æ—¶é—´**: 2026-01-20  
**æµ‹è¯•æ–¹å¼**: æ‰‹åŠ¨æµ‹è¯• + æ—¥å¿—æ£€æŸ¥  
**æµ‹è¯•è€…**: ç”¨æˆ·  
**çŠ¶æ€**: â³ ç­‰å¾…æµ‹è¯•ç»“æœ
