# ASR音频拒绝分析报告

**日期**: 2026-01-28  
**问题**: 检查ASR是否丢弃了音频内容

---

## 一、分析结果

### 1.1 ASR音频质量拒绝统计

**从日志分析发现**：
- **总共4个job的音频被拒绝**（RMS < 0.008）
- 这些被拒绝的音频返回了空结果
- 被拒绝的job：
  - `job-29b3fea1` (utteranceIndex=6): RMS=0.0007, 音频时长1040ms
  - `job-63181906` (utteranceIndex=9): RMS=0.0007, 音频时长2860ms
  - `job-c131c359` (utteranceIndex=10): RMS=0.0007, 音频时长260ms
  - `job-69b1f8d0` (utteranceIndex=12): RMS=0.0008, 音频时长3380ms

### 1.2 关键Job的音频处理情况

**Job3 (job-960d8f27, utteranceIndex=3)**：
- 输入音频时长：8840ms
- 音频切分：被切分成多个segment
- ASR批次：3个batch，都成功返回文本
- **没有音频被拒绝**

**Job5 (job-23b12aac, utteranceIndex=5)**：
- 输入音频时长：7800ms
- 音频切分：被切分成多个segment
- ASR批次：2个batch，都成功返回文本
- **没有音频被拒绝**

**Job11 (job-e94b2cb6, utteranceIndex=11)**：
- 输入音频时长：4940ms
- 音频切分：1个segment
- ASR批次：1个batch，成功返回文本（31字符）
- **没有音频被拒绝**

---

## 二、关键发现

### 2.1 ASR没有丢弃关键Job的音频

**关键发现**：
- ✅ **Job3, Job5, Job11都没有音频被拒绝**
- ✅ **所有batch都成功返回了文本**
- ✅ **文本被成功发送到scheduler**

### 2.2 文本被发送后又被清空

**从日志发现的关键问题**：

**Job3 (job-960d8f27)**：
- ✅ 文本被成功发送到scheduler（76字符）
- ❌ 但后来被标记为"Empty container (NO_TEXT_ASSIGNED)"
- ❌ 发送了空结果到scheduler

**Job5 (job-23b12aac)**：
- ✅ 文本被成功发送到scheduler（45字符）
- ❌ 但后来被标记为"ASR result is empty"
- ❌ 发送了空结果到scheduler

**Job11 (job-e94b2cb6)**：
- ✅ 文本被成功发送到scheduler（31字符）
- ❌ 但后来被标记为"ASR result is empty"
- ❌ 发送了空结果到scheduler

**问题**：
- 文本被成功处理并发送，但后来又被清空
- 这可能是因为文本被错误地分配或合并到了其他job

### 2.2 问题可能的原因

**原因1: ASR服务返回的文本本身不完整**
- ASR服务可能因为音频质量问题（虽然通过了RMS检查），只返回了部分文本
- 或者ASR服务在处理长音频时，只返回了部分结果

**原因2: 音频切分导致部分音频没有被送入ASR**
- 音频在切分时可能被错误地分割
- 导致某些音频片段没有被送入ASR
- 或者某些音频片段被错误地分配到了其他job

**原因3: 某些batch被错误地分配到了其他job**
- 类似之前的batch分配问题
- 某些batch可能被分配到了其他job，导致当前job的文本不完整

---

## 三、下一步分析

### 3.1 检查ASR服务返回的完整文本

**需要检查**：
- ASR服务是否返回了完整的文本
- 是否有部分文本被截断
- 是否有音频片段没有被处理

### 3.2 检查音频切分和分配

**需要检查**：
- 音频切分是否正确
- 所有音频片段是否都被送入ASR
- batch分配是否正确

### 3.3 检查音频时长和文本长度的对应关系

**需要检查**：
- 音频时长是否与ASR返回的文本长度匹配
- 是否有音频片段没有被处理

---

## 四、总结

### 4.1 ASR音频拒绝情况

- ✅ **关键Job（Job3, Job5, Job11）都没有音频被拒绝**
- ⚠️ **有4个其他Job的音频被拒绝（RMS过低）**
- ❌ **但这些被拒绝的Job不是导致文本丢失的原因**

### 4.2 文本丢失的真正原因

- **不是ASR音频拒绝**：关键Job的音频都通过了质量检查
- **不是ASR服务返回的文本不完整**：ASR返回了完整的文本
- **文本被发送后又被清空**：文本被成功处理并发送，但后来又被标记为空并发送了空结果
- **可能是文本被错误地分配或合并**：需要检查文本分配和合并的逻辑

---

*本分析基于日志数据，需要进一步检查ASR服务的详细日志和音频切分的详细日志。*
