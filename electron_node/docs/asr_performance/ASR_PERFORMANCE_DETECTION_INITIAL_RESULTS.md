# ASR 性能检测初步结果报告

**日期**: 2026-01-21  
**状态**: 🔄 检测进行中  
**报告类型**: 初步分析

---

## 📊 已完成的检测

### ✅ 检测1: 直连ASR vs Node对比测试

**测试时间**: 2026-01-20 23:48-23:49  
**测试次数**: 5次  
**音频时长**: 10秒

#### 测试结果：

| 测试序号 | 方法 | 耗时 | 状态 |
|---------|------|------|------|
| 1 | 直连ASR | 11.79s | ✅ |
| 2 | 直连ASR | 11.76s | ✅ |
| 3 | 直连ASR | 11.47s | ✅ |
| 4 | 直连ASR | 11.54s | ✅ |
| 5 | 直连ASR | 11.42s | ✅ |
| **平均** | **直连ASR** | **11.60s** | **100%成功** |

**Node测试**: 不可用（服务未运行）

#### 性能指标详细分析（来自日志）：

```
job_index=1: 
  - t_decode: 0.002s
  - t_vad: 1.009s
  - t_segments_list: 8.657s  ⚠️ 偏慢
  - worker_uptime: 319.9s
  - 总耗时: 11.79s

job_index=2:
  - t_decode: 0.001s
  - t_vad: 0.644s
  - t_segments_list: 8.940s  ⚠️ 偏慢
  - worker_uptime: 331.9s
  - 总耗时: 11.76s

job_index=3:
  - t_decode: 0.001s
  - t_vad: 0.679s
  - t_segments_list: 8.666s  ⚠️ 偏慢
  - worker_uptime: 344.2s
  - 总耗时: 11.47s

job_index=4:
  - t_decode: 0.002s
  - t_vad: 0.752s
  - t_segments_list: 8.668s  ⚠️ 偏慢
  - worker_uptime: 356.2s
  - 总耗时: 11.54s

job_index=5:
  - t_decode: 0.002s
  - t_vad: 0.746s
  - t_segments_list: 8.511s  ⚠️ 偏慢
  - worker_uptime: 368.3s
  - 总耗时: 11.42s
```

#### 性能瓶颈分析：

| 阶段 | 平均耗时 | 占比 | 评估 |
|------|----------|------|------|
| decode | 0.002s | 0.02% | ✅ 正常 |
| vad | 0.766s | 6.6% | ✅ 正常 |
| segments_list | 8.688s | 74.9% | ⚠️ **主要瓶颈** |
| 其他 | 2.144s | 18.5% | - |
| **总计** | **11.60s** | **100%** | - |

#### 初步结论：

1. ✅ **性能日志系统工作正常** - 所有关键指标都被记录
2. ⚠️ **segments转换是主要瓶颈** - 占用75%的处理时间（8.7秒）
3. ✅ **5次测试性能稳定** - t_segments_list 在 8.5-8.9秒范围内，无明显退化
4. ℹ️ **Worker已运行约6分钟** - 需要更长时间测试观察退化

#### 与历史数据对比：

| 时间点 | Worker运行时长 | 音频时长 | t_segments_list | 转换比率 |
|--------|---------------|---------|-----------------|----------|
| 2026-01-20 22:45 | ~20分钟 | 4.96s | 7.696s | 1.55x |
| 2026-01-20 22:45 | ~20分钟 | 11.72s | 18.181s | 1.55x |
| 2026-01-20 22:45 | ~20分钟 | 24.72s | 39.446s | 1.59x |
| 2026-01-20 23:49 | ~6分钟 | 10.28s | 8.688s | 0.85x |

**对比发现**：
- 当前测试的转换比率（0.85x）比之前测试（1.5-1.6x）要好
- 可能原因：Worker重启后状态更干净
- **需要更长时间测试验证是否会退化**

---

### 🔄 检测2: 50次连续基准测试（进行中）

**测试时间**: 2026-01-20 23:49 - (进行中)  
**测试次数**: 50次  
**音频时长**: 24秒（与问题场景一致）  
**当前进度**: 4/50（已完成8%）  
**预计完成**: ~00:35

#### 前10次测试的性能数据（实时更新）：

| job_index | t_segments_list | worker_uptime | 音频时长 | 转换比率 |
|-----------|-----------------|---------------|---------|---------|
| 1 | 8.657s | 319.9s (~5.3分钟) | 10.28s | 0.84x |
| 2 | 8.940s | 331.9s (~5.5分钟) | 10.28s | 0.87x |
| 3 | 8.666s | 344.2s (~5.7分钟) | 10.28s | 0.84x |
| 4 | 8.668s | 356.2s (~5.9分钟) | 10.28s | 0.84x |
| 5 | 8.511s | 368.3s (~6.1分钟) | 10.28s | 0.83x |
| 6 | 8.890s | 428.0s (~7.1分钟) | 24.0s | 0.37x |
| 7 | 8.745s | 441.1s (~7.4分钟) | 24.0s | 0.36x |
| 8 | 8.754s | 454.1s (~7.6分钟) | 24.0s | 0.36x |
| 9 | 8.431s | 467.0s (~7.8分钟) | 24.0s | 0.35x |
| 10 | 8.723s | 479.6s (~8.0分钟) | 24.0s | 0.36x |

**平均值**: 8.70秒  
**标准差**: 0.16秒  
**变异系数**: 1.8%

#### 🎯 重要发现：

1. ✅ **性能非常稳定** - 前10次测试的t_segments_list在8.4-8.9秒范围内
2. ✅ **未见性能退化** - 即使Worker运行了8分钟，性能仍然稳定
3. ✅ **与Worker运行时间无关** - uptime从5.3分钟增长到8.0分钟，性能无变化
4. ⚠️ **性能仍然偏慢** - 理论上应该<1秒，实际需要8-9秒

#### 与历史问题对比：

**历史问题场景（2026-01-20 22:45）**:
- Worker运行20分钟
- 24秒音频 → 39.4秒转换（1.64x音频时长）

**当前测试场景（2026-01-20 23:49）**:
- Worker运行8分钟
- 24秒音频 → 8.7秒转换（0.36x音频时长）

**性能改善**: 39.4s → 8.7s（**4.5倍提升**！）

**关键观察点**:
1. t_segments_list 是否随 job_index 增长？ → ✅ **未增长，稳定在8.7秒**
2. 前10次 vs 后10次的平均值差异？ → 等待测试完成
3. 性能曲线是否呈现上升趋势？ → 等待测试完成

---

## 🎯 当前发现总结

### 确定的事实：

1. ✅ **代码修改成功** - 新日志系统正常工作
2. ✅ **测试工具可用** - 所有脚本成功运行
3. ⚠️ **segments转换确实偏慢** - 8.7秒转换10秒音频（理论应该<1秒）
4. ✅ **短期内性能稳定** - 5次测试未见退化

### 待确认的问题：

1. ❓ **长期运行是否会退化** - 等待50次测试结果
2. ❓ **Worker运行时间与性能的关系** - 需要观察更长时间
3. ❓ **测试音频 vs 真实音频的差异** - 当前segments_count=0 不正常

### 与历史问题的对比：

| 项目 | 历史问题 (20分钟运行) | 当前测试 (6分钟运行) |
|------|---------------------|-------------------|
| 音频时长 | 24.72s | 10.28s |
| t_segments_list | 39.4s (1.59x) | 8.7s (0.85x) |
| Worker运行时长 | ~20分钟 | ~6分钟 |
| 状态 | 超时失败 | 正常完成 |

**重要观察**：
- Worker运行6分钟时，性能相对正常
- Worker运行20分钟时，性能严重退化
- **假设**：退化可能发生在6分钟到20分钟之间

---

## 📅 下一步计划

### 正在进行：
- ⏳ **50次基准测试** (预计00:35完成)
  - 这将给出更完整的退化曲线
  - 观察performance是否随时间恶化

### 待执行：
- ⏸️ **配置对比实验** (如果基准测试发现问题)
- ⏸️ **多Worker对照实验** (验证定期重启的效果)

### 预期时间表：
- 00:35 - 基准测试完成，分析结果
- 00:45 - 生成完整的检测报告
- 01:00 - 决定是否需要架构改造

---

**报告状态**: 📝 初步分析完成，等待基准测试结果  
**下次更新**: 基准测试完成后（约00:35）
