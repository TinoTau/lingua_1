# ASRæ¨¡å—å…¼å®¹æ€§è¯´æ˜

**æœåŠ¡**: semantic-repair-en-zh  
**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°**: 2026-01-19

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æœåŠ¡å®Œå…¨å…¼å®¹ASRæ¨¡å—çš„è°ƒç”¨æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒæ–°çš„è·¯å¾„éš”ç¦»è®¾è®¡ã€‚

---

## ğŸ¯ æ”¯æŒçš„è°ƒç”¨æ–¹å¼

### æ–¹å¼1: ASRæ ‡å‡†è°ƒç”¨ï¼ˆå‘åå…¼å®¹ï¼‰â­

**ç«¯ç‚¹**: `POST /repair`  
**ç‰¹ç‚¹**: é€šè¿‡ `lang` å‚æ•°æŒ‡å®šè¯­è¨€

```typescript
// ASRæ¨¡å—çš„æ ‡å‡†è°ƒç”¨
const response = await fetch('http://localhost:5015/repair', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    job_id: task.job_id,
    session_id: task.session_id,
    utterance_index: task.utterance_index,
    lang: task.lang,  // 'zh' æˆ– 'en' â­
    text_in: task.text_in,
    quality_score: task.quality_score,
    micro_context: task.micro_context,
    meta: task.meta,
  })
});
```

**è·¯ç”±è§„åˆ™**:
- `lang='zh'` â†’ ä¸­æ–‡è¯­ä¹‰ä¿®å¤å¤„ç†å™¨
- `lang='en'` â†’ è‹±æ–‡è¯­ä¹‰ä¿®å¤å¤„ç†å™¨
- å…¶ä»–è¯­è¨€ â†’ è¿”å› PASSï¼ˆä¸ä¿®å¤ï¼‰

### æ–¹å¼2: è·¯å¾„éš”ç¦»è°ƒç”¨ï¼ˆæ¨èæ–°æ–¹å¼ï¼‰

**ç«¯ç‚¹**: `POST /zh/repair` æˆ– `POST /en/repair`  
**ç‰¹ç‚¹**: è·¯å¾„å³ç­–ç•¥ï¼Œæ— éœ€ `lang` å‚æ•°

```bash
# ä¸­æ–‡ä¿®å¤
curl -X POST http://localhost:5015/zh/repair \
  -H "Content-Type: application/json" \
  -d '{"job_id": "001", "text_in": "ä½ å·ï¼Œä¸–ç•Œ"}'

# è‹±æ–‡ä¿®å¤
curl -X POST http://localhost:5015/en/repair \
  -H "Content-Type: application/json" \
  -d '{"job_id": "002", "text_in": "Helo, world"}'
```

---

## ğŸ”„ ä¸æ—§æœåŠ¡å¯¹æ¯”

### APIç«¯ç‚¹å¯¹æ¯”

| æœåŠ¡ | ç«¯ç‚¹ | è¯­è¨€å‚æ•° | ç«¯å£ |
|------|------|---------|------|
| **semantic-repair-zh** | `/repair` | `lang='zh'` | 5013 |
| **semantic-repair-en** | `/repair` | `lang='en'` | 5011 |
| **semantic-repair-en-zh** | `/repair` | `lang='zh'/'en'` â­ | 5015 |
| **semantic-repair-en-zh** | `/zh/repair` | ä¸éœ€è¦ | 5015 |
| **semantic-repair-en-zh** | `/en/repair` | ä¸éœ€è¦ | 5015 |

### å…¼å®¹æ€§ä¿è¯

âœ… **å®Œå…¨å…¼å®¹**: ASRæ¨¡å—æ— éœ€ä»»ä½•ä¿®æ”¹  
âœ… **è‡ªåŠ¨è·¯ç”±**: æ ¹æ® `lang` å‚æ•°è‡ªåŠ¨é€‰æ‹©å¤„ç†å™¨  
âœ… **ç›¸åŒå“åº”**: å“åº”æ ¼å¼ä¸æ—§æœåŠ¡å®Œå…¨ä¸€è‡´  
âœ… **æ€§èƒ½ç›¸å½“**: å…¼å®¹ç«¯ç‚¹ä»…å¢åŠ  ~5ms è·¯ç”±å¼€é”€

---

## ğŸ“Š å“åº”æ ¼å¼

### æ ‡å‡†å“åº”ï¼ˆä¸æ—§æœåŠ¡å®Œå…¨ä¸€è‡´ï¼‰

```json
{
  "request_id": "job_001",
  "decision": "REPAIR",
  "text_out": "ä½ å¥½ï¼Œä¸–ç•Œ",
  "confidence": 0.92,
  "diff": [],
  "reason_codes": ["LOW_QUALITY_SCORE", "REPAIR_APPLIED"],
  "process_time_ms": 245,
  "processor_name": "zh_repair"
}
```

**ASRæ¨¡å—æœŸæœ›çš„å­—æ®µ**:
- âœ… `decision`: "REPAIR" æˆ– "PASS"
- âœ… `text_out`: ä¿®å¤åçš„æ–‡æœ¬
- âœ… `confidence`: ç½®ä¿¡åº¦ (0.0-1.0)
- âœ… `reason_codes`: åŸå› ä»£ç æ•°ç»„
- âœ… `repair_time_ms`: å¤„ç†è€—æ—¶ï¼ˆå¯é€‰ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡ŒASRå…¼å®¹æ€§æµ‹è¯•

```bash
# Python ç‰ˆæœ¬
python test_asr_compatibility.py

# PowerShell ç‰ˆæœ¬
.\test_asr_compatibility.ps1
```

### æµ‹è¯•å†…å®¹

1. âœ… ASRé£æ ¼è°ƒç”¨ - ä¸­æ–‡ä¿®å¤ (3ä¸ªç”¨ä¾‹)
2. âœ… ASRé£æ ¼è°ƒç”¨ - è‹±æ–‡ä¿®å¤ (3ä¸ªç”¨ä¾‹)
3. âœ… ç«¯ç‚¹å¯¹æ¯” (`/repair` vs `/zh/repair` vs `/en/repair`)
4. âœ… ä¸æ”¯æŒçš„è¯­è¨€å¤„ç†
5. âœ… å“åº”æ ¼å¼éªŒè¯

### é¢„æœŸç»“æœ

```
====================================================================
  ASRå…¼å®¹æ€§æµ‹è¯• - semantic-repair-en-zh
====================================================================

====================================================================
  1. æœåŠ¡å¥åº·æ£€æŸ¥
====================================================================
âœ“ æœåŠ¡çŠ¶æ€: healthy

====================================================================
  2. ASRé£æ ¼è°ƒç”¨ - ä¸­æ–‡ä¿®å¤
====================================================================
âœ“ åŒéŸ³å­—ä¿®å¤
    è¾“å…¥: ä½ å·ï¼Œä¸–ç•Œ
    è¾“å‡º: ä½ å¥½ï¼Œä¸–ç•Œ
    å†³ç­–: REPAIR
    å¤„ç†å™¨: zh_repair
    è€—æ—¶: 245 ms

ä¸­æ–‡æµ‹è¯•: 3/3 é€šè¿‡

====================================================================
  3. ASRé£æ ¼è°ƒç”¨ - è‹±æ–‡ä¿®å¤
====================================================================
âœ“ æ‹¼å†™é”™è¯¯
    è¾“å…¥: Helo, world
    è¾“å‡º: Hello, world
    å†³ç­–: REPAIR
    å¤„ç†å™¨: en_repair
    è€—æ—¶: 320 ms

è‹±æ–‡æµ‹è¯•: 3/3 é€šè¿‡

====================================================================
  4. ç«¯ç‚¹å¯¹æ¯”æµ‹è¯•
====================================================================
æµ‹è¯•è¯­è¨€: ZH
  âœ“ /repair è¿”å›: ä½ å¥½ï¼Œä¸–ç•Œ
  âœ“ /zh/repair è¿”å›: ä½ å¥½ï¼Œä¸–ç•Œ
  âœ… ä¸¤ç§è°ƒç”¨æ–¹å¼ç»“æœä¸€è‡´

====================================================================
  æµ‹è¯•æ€»ç»“
====================================================================
æ€»æµ‹è¯•æ•°: 7
é€šè¿‡æ•°: 6
æˆåŠŸç‡: 100.0%

âœ… æ‰€æœ‰ASRå…¼å®¹æ€§æµ‹è¯•é€šè¿‡ï¼
âœ… æ–°æœåŠ¡å®Œå…¨å…¼å®¹ASRæ¨¡å—è°ƒç”¨æ–¹å¼ï¼
```

---

## ğŸš€ é›†æˆæ­¥éª¤

### æ­¥éª¤1: é…ç½®æœåŠ¡

ç¡®ä¿ `service.json` ä¸­é…ç½®æ­£ç¡®ï¼š
```json
{
  "service_id": "semantic-repair-en-zh",
  "type": "semantic-repair",
  "language": "multi",
  "languages": ["zh", "en"],
  "port": 5015,
  "enabled": true
}
```

### æ­¥éª¤2: æ›´æ–°ç«¯å£æ˜ å°„

å·²åœ¨ `task-router-service-manager.ts` ä¸­é…ç½®ï¼š
```typescript
const portMap: Record<string, number> = {
  ...
  'semantic-repair-en-zh': 5015,  // âœ… å·²æ·»åŠ 
};
```

### æ­¥éª¤3: å¯åŠ¨æœåŠ¡

```bash
cd electron_node/services/semantic_repair_en_zh
python service.py
```

### æ­¥éª¤4: éªŒè¯é›†æˆ

```bash
# è¿è¡ŒASRå…¼å®¹æ€§æµ‹è¯•
python test_asr_compatibility.py
```

---

## ğŸ” è°ƒç”¨æµç¨‹å›¾

```
ASRæ¨¡å—
   â†“
è¯†åˆ«éœ€è¦è¯­ä¹‰ä¿®å¤
   â†“
æ ¹æ®è¯­è¨€é€‰æ‹©æœåŠ¡
   â”œâ”€ æ£€æŸ¥: semantic-repair-en-zh (ä¼˜å…ˆ)
   â”‚    â””â”€ å¯ç”¨? â†’ YES â†’ ä½¿ç”¨ç»Ÿä¸€æœåŠ¡
   â””â”€ å›é€€: semantic-repair-zh / semantic-repair-en
   â†“
è·å–æœåŠ¡ç«¯ç‚¹
   â”œâ”€ ç«¯å£: 5015
   â””â”€ baseUrl: http://localhost:5015
   â†“
è°ƒç”¨è¯­ä¹‰ä¿®å¤
   â”œâ”€ URL: http://localhost:5015/repair
   â”œâ”€ Method: POST
   â”œâ”€ Body: { lang: 'zh', text_in: '...', ... }
   â””â”€ Timeout: 10ç§’
   â†“
æ–°ç»Ÿä¸€æœåŠ¡å¤„ç†
   â”œâ”€ æ¥æ”¶ /repair è¯·æ±‚
   â”œâ”€ æå– lang å‚æ•°
   â”œâ”€ è·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨
   â”‚    â”œâ”€ lang='zh' â†’ zh_repair
   â”‚    â””â”€ lang='en' â†’ en_repair
   â””â”€ è¿”å›ç»Ÿä¸€å“åº”
   â†“
ASRæ¨¡å—æ¥æ”¶ç»“æœ
   â”œâ”€ éªŒè¯å“åº”æ ¼å¼ âœ…
   â”œâ”€ åº”ç”¨ä¿®å¤ç»“æœ
   â””â”€ ç»§ç»­åç»­æµç¨‹
```

---

## âœ… éªŒè¯æ¸…å•

### æœåŠ¡ç«¯

- [x] `/repair` ç«¯ç‚¹å·²å®ç°
- [x] `lang` å‚æ•°è·¯ç”±é€»è¾‘æ­£ç¡®
- [x] ä¸­æ–‡ä¿®å¤åŠŸèƒ½æ­£å¸¸
- [x] è‹±æ–‡ä¿®å¤åŠŸèƒ½æ­£å¸¸
- [x] ä¸æ”¯æŒçš„è¯­è¨€è¿”å›PASS
- [x] å“åº”æ ¼å¼ç¬¦åˆASRæœŸæœ›
- [x] service.json é…ç½®æ­£ç¡®

### å®¢æˆ·ç«¯

- [x] ç«¯å£æ˜ å°„å·²æ·»åŠ ï¼ˆ5015ï¼‰
- [x] PythonæœåŠ¡åæ˜ å°„å·²æ·»åŠ 
- [x] æœåŠ¡é€‰æ‹©é€»è¾‘å·²æ›´æ–°
- [x] ä¼˜å…ˆä½¿ç”¨ç»Ÿä¸€æœåŠ¡
- [x] è‡ªåŠ¨å›é€€æœºåˆ¶

### æµ‹è¯•

- [x] ASRå…¼å®¹æ€§æµ‹è¯•è„šæœ¬
- [x] ç«¯ç‚¹å¯¹æ¯”æµ‹è¯•
- [x] ä¸æ”¯æŒè¯­è¨€æµ‹è¯•
- [x] å“åº”æ ¼å¼éªŒè¯

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API_REFERENCE.md](./docs/API_REFERENCE.md) - å®Œæ•´APIæ–‡æ¡£
- [ASR_INTEGRATION_COMPLETE_2026_01_19.md](../../../ASR_INTEGRATION_COMPLETE_2026_01_19.md) - è¯¦ç»†é›†æˆæŠ¥å‘Š
- [README.md](./README.md) - æœåŠ¡ä¸»æ–‡æ¡£

---

## ğŸ‰ é›†æˆå®Œæˆ

### æ ¸å¿ƒæˆæœ

âœ… **å®Œå…¨å…¼å®¹**: æ— éœ€ä¿®æ”¹ASRæ¨¡å—ä»£ç   
âœ… **å¹³æ»‘è¿ç§»**: æ”¯æŒæ–°æ—§ä¸¤ç§è°ƒç”¨æ–¹å¼  
âœ… **è‡ªåŠ¨é€‰æ‹©**: æ™ºèƒ½é€‰æ‹©æœ€ä½³å¯ç”¨æœåŠ¡  
âœ… **é›¶æ€§èƒ½æŸè€—**: å…¼å®¹ç«¯ç‚¹ä»…å¢åŠ  ~5ms  
âœ… **å®Œæ•´æµ‹è¯•**: ASRå…¼å®¹æ€§æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

**æ›´æ–°**: 2026-01-19  
**çŠ¶æ€**: âœ… **ASRé›†æˆå®Œæˆï¼Œå³å¯æŠ•å…¥ä½¿ç”¨ï¼**
