# é›†æˆæµ‹è¯•åˆ†æï¼ˆä¿®å¤åï¼‰

**æ—¥æœŸ**: 2025-12-25  
**çŠ¶æ€**: âš ï¸ **é—®é¢˜ä»ç„¶å­˜åœ¨**

---

## æ—¥å¿—åˆ†æç»“æœ

### ASRæœåŠ¡æ—¥å¿—

**å…³é”®å‘ç°**:
1. **æ‰€æœ‰jobçš„éŸ³é¢‘éƒ½åªæœ‰0.24ç§’ï¼ˆ3840 samplesï¼‰**
   - `job-D23B2D3B`: `original_duration_sec=0.240`
   - `job-185E2413`: `original_duration_sec=0.240`
   - `job-8FB49FD8`: `original_duration_sec=0.240`
   - `job-F29DB7D0`: `original_duration_sec=0.240`

2. **ASRè¿”å›ç©ºæ–‡æœ¬ï¼ˆsegments=0ï¼‰**
   - `job-D23B2D3B`: `segments=0, text_len=0`
   - `job-185E2413`: `segments=0, text_len=0`
   - `job-8FB49FD8`: `segments=0, text_len=0`ï¼ˆéŸ³é¢‘è´¨é‡å¤ªå·®è¢«è¿‡æ»¤ï¼‰
   - `job-F29DB7D0`: `segments=0, text_len=0`ï¼ˆéŸ³é¢‘è´¨é‡å¤ªå·®è¢«è¿‡æ»¤ï¼‰

3. **éƒ¨åˆ†jobå› éŸ³é¢‘è´¨é‡å¤ªå·®è¢«è¿‡æ»¤**
   - `job-8FB49FD8`: `RMS too low (0.0007 < 0.005), std too low (0.0007 < 0.01), dynamic_range too small (0.0050 < 0.02)`
   - `job-F29DB7D0`: `RMS too low (0.0006 < 0.005), std too low (0.0006 < 0.01), dynamic_range too small (0.0048 < 0.02)`

### è°ƒåº¦æœåŠ¡å™¨æ—¥å¿—

**å…³é”®å‘ç°**:
1. **æ‰€æœ‰jobçš„finalizeåŸå› éƒ½æ˜¯`Pause`æˆ–`IsFinal`**
   - `job-D23B2D3B`: `reason="Pause"`
   - `job-185E2413`: `reason="Pause"`
   - `job-8FB49FD8`: `reason="IsFinal"`
   - `job-F29DB7D0`: `reason="IsFinal"`

2. **éŸ³é¢‘å¤§å°åªæœ‰çº¦8-9KBï¼ˆå¯¹åº”0.24ç§’ï¼‰**
   - `job-D23B2D3B`: `audio_size_bytes=8287`
   - `job-185E2413`: `audio_size_bytes=9273`
   - `job-8FB49FD8`: `audio_size_bytes=8900`
   - `job-F29DB7D0`: `audio_size_bytes=5621`

3. **æ‰€æœ‰job_resultéƒ½æ˜¯ç©ºæ–‡æœ¬**
   - æ‰€æœ‰jobçš„`text_asr`å’Œ`text_translated`éƒ½æ˜¯ç©ºå­—ç¬¦ä¸²

### èŠ‚ç‚¹ç«¯æ—¥å¿—

**å…³é”®å‘ç°**:
1. **æ‰€æœ‰ASRç»“æœéƒ½æ˜¯ç©ºçš„**
   - `ASR result is empty, skipping NMT and TTS`
   - `ASR result is empty (silence detected), sending empty job_result`

---

## é—®é¢˜åˆ†æ

### é—®é¢˜1: éŸ³é¢‘ä»ç„¶åªæœ‰0.24ç§’ âš ï¸

**è¯´æ˜**: Webç«¯çš„é™éŸ³è¿‡æ»¤ä¿®å¤å¯èƒ½æ²¡æœ‰ç”Ÿæ•ˆï¼Œæˆ–è€…é—®é¢˜ä¸åœ¨é™éŸ³è¿‡æ»¤

**å¯èƒ½åŸå› **:
1. **Webç«¯æ²¡æœ‰é‡æ–°ç¼–è¯‘**: ä¿®æ”¹äº†`types.ts`ä½†æ²¡æœ‰é‡æ–°ç¼–è¯‘
2. **Webç«¯é™éŸ³è¿‡æ»¤é…ç½®æ²¡æœ‰ç”Ÿæ•ˆ**: é…ç½®å¯èƒ½è¢«å…¶ä»–åœ°æ–¹è¦†ç›–
3. **é—®é¢˜ä¸åœ¨é™éŸ³è¿‡æ»¤**: å¯èƒ½æ˜¯å…¶ä»–åŸå› å¯¼è‡´åªå‘é€äº†2-3ä¸ªaudio_chunk

### é—®é¢˜2: ASRè¿”å›ç©ºæ–‡æœ¬ âš ï¸

**è¯´æ˜**: å³ä½¿éŸ³é¢‘é€šè¿‡äº†è´¨é‡æ£€æŸ¥ï¼ŒASRä»ç„¶è¿”å›ç©ºæ–‡æœ¬

**å¯èƒ½åŸå› **:
1. **éŸ³é¢‘å¤ªçŸ­**: 0.24ç§’å¯¹äºFaster Whisperæ¥è¯´å¤ªçŸ­ï¼Œæ— æ³•è¯†åˆ«
2. **éŸ³é¢‘è´¨é‡å·®**: è™½ç„¶é€šè¿‡äº†è´¨é‡æ£€æŸ¥ï¼Œä½†è´¨é‡ä»ç„¶ä¸å¤Ÿå¥½
3. **Faster Whisperé…ç½®é—®é¢˜**: å¯èƒ½éœ€è¦è°ƒæ•´å‚æ•°ä»¥é€‚åº”çŸ­éŸ³é¢‘

### é—®é¢˜3: éƒ¨åˆ†éŸ³é¢‘è´¨é‡å¤ªå·®è¢«è¿‡æ»¤ âš ï¸

**è¯´æ˜**: æœ‰äº›jobçš„éŸ³é¢‘è´¨é‡å¤ªå·®ï¼ˆRMSã€stdã€dynamic_rangeéƒ½å¤ªä½ï¼‰ï¼Œç›´æ¥è¢«è¿‡æ»¤

**å¯èƒ½åŸå› **:
1. **Opusè§£ç é—®é¢˜**: è§£ç åçš„éŸ³é¢‘è´¨é‡å¤ªå·®
2. **Webç«¯ç¼–ç é—®é¢˜**: ç¼–ç æ—¶å¯èƒ½æœ‰é—®é¢˜
3. **ç½‘ç»œä¼ è¾“é—®é¢˜**: ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¸¢å¤±äº†æ•°æ®

---

## ä¿®å¤å»ºè®®

### 1. ç¡®è®¤Webç«¯æ˜¯å¦é‡æ–°ç¼–è¯‘ âš ï¸

**æ£€æŸ¥**:
- Webç«¯æ˜¯å¦é‡æ–°ç¼–è¯‘äº†ï¼ˆ`npm run build`ï¼‰
- æµè§ˆå™¨æ˜¯å¦åˆ·æ–°äº†é¡µé¢
- æ˜¯å¦ä½¿ç”¨äº†æ–°çš„æ„å»ºç‰ˆæœ¬

**ä¿®å¤**:
```bash
cd webapp/web-client
npm run build
# ç„¶åé‡å¯Webç«¯
```

### 2. æ£€æŸ¥Webç«¯é™éŸ³è¿‡æ»¤é…ç½®æ˜¯å¦ç”Ÿæ•ˆ âš ï¸

**æ£€æŸ¥**:
- æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰VADæ—¥å¿—
- æ˜¯å¦çœ‹åˆ°`[VAD] âœ… æ£€æµ‹åˆ°è¯­éŸ³ï¼Œå¼€å§‹å‘é€éŸ³é¢‘`
- æ˜¯å¦çœ‹åˆ°`[VAD] ğŸ”‡ æ£€æµ‹åˆ°é™éŸ³ï¼Œåœæ­¢å‘é€éŸ³é¢‘`

**ä¿®å¤**:
- å¦‚æœçœ‹åˆ°è¿‡æ—©åœæ­¢å‘é€ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´é…ç½®
- å¦‚æœçœ‹ä¸åˆ°VADæ—¥å¿—ï¼Œå¯èƒ½é™éŸ³è¿‡æ»¤æ²¡æœ‰å¯ç”¨

### 3. ä¸´æ—¶ç¦ç”¨é™éŸ³è¿‡æ»¤è¿›è¡Œæµ‹è¯• âš ï¸

**ç›®çš„**: ç¡®è®¤é—®é¢˜æ˜¯å¦åœ¨é™éŸ³è¿‡æ»¤

**ä¿®å¤**:
```typescript
// webapp/web-client/src/types.ts
export const DEFAULT_SILENCE_FILTER_CONFIG: SilenceFilterConfig = {
  enabled: false, // ä¸´æ—¶ç¦ç”¨
  // ...
};
```

### 4. æ£€æŸ¥è°ƒåº¦æœåŠ¡å™¨çš„pauseæ£€æµ‹ âš ï¸

**æ£€æŸ¥**:
- `pause_ms`é…ç½®å€¼
- chunkä¹‹é—´çš„æ—¶é—´é—´éš”æ˜¯å¦çœŸçš„ > pause_ms
- æ˜¯å¦æœ‰å…¶ä»–è§¦å‘finalizeçš„æ¡ä»¶

**ä¿®å¤**:
- å¢åŠ `pause_ms`ï¼ˆæ¯”å¦‚ä»2000mså¢åŠ åˆ°3000msï¼‰
- æˆ–è€…ï¼šä¿®å¤pauseæ£€æµ‹é€»è¾‘

### 5. å¢åŠ æœ€çŸ­éŸ³é¢‘æ—¶é•¿æ£€æŸ¥ âš ï¸

**ç›®çš„**: å¦‚æœéŸ³é¢‘< 0.5ç§’ï¼Œç›´æ¥è¿”å›ç©ºæ–‡æœ¬ï¼Œä¸è¿›å…¥ASR

**ä¿®å¤**:
```python
# faster_whisper_vad_service.py
MIN_AUDIO_DURATION_SEC = 0.5  # æœ€çŸ­éŸ³é¢‘æ—¶é•¿

if processed_audio_duration < MIN_AUDIO_DURATION_SEC:
    logger.warning(f"[{trace_id}] Audio too short ({processed_audio_duration:.3f}s < {MIN_AUDIO_DURATION_SEC}s), returning empty response")
    return empty_response
```

---

## ä¸‹ä¸€æ­¥

1. âœ… **ç¡®è®¤Webç«¯æ˜¯å¦é‡æ–°ç¼–è¯‘**: æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ–°çš„æ„å»ºç‰ˆæœ¬
2. âš ï¸ **æ£€æŸ¥Webç«¯VADæ—¥å¿—**: æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰VADç›¸å…³æ—¥å¿—
3. âš ï¸ **ä¸´æ—¶ç¦ç”¨é™éŸ³è¿‡æ»¤**: ç¡®è®¤é—®é¢˜æ˜¯å¦åœ¨é™éŸ³è¿‡æ»¤
4. âš ï¸ **æ£€æŸ¥è°ƒåº¦æœåŠ¡å™¨pauseæ£€æµ‹**: ç¡®è®¤chunkä¹‹é—´çš„æ—¶é—´é—´éš”

---

**åˆ†æå®Œæˆæ—¶é—´**: 2025-12-25  
**çŠ¶æ€**: âš ï¸ **é—®é¢˜ä»ç„¶å­˜åœ¨ï¼šéŸ³é¢‘ä»ç„¶åªæœ‰0.24ç§’ï¼ŒASRè¿”å›ç©ºæ–‡æœ¬**

